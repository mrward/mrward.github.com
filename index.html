
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Matt Ward</title>
  <meta name="author" content="Matt Ward">

  
  <meta name="description" content="The NuGet extensions addin now includes a PowerShell
Core based NuGet Package Manager console for Visual Studio for Mac 8.0. A NuGet PowerShell &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lastexitcode.com">
  <link href="/favicon.ico" rel="icon" type="image/x-icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Matt Ward" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34592677-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Matt Ward</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
  
  
  
  
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="lastexitcode.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/projects/">Projects</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/05/05/NuGetPowerShellCoreConsoleVisualStudioForMac8-0/">NuGet PowerShell Core Console in Visual Studio for Mac 8.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-05-05T12:40:00+01:00" pubdate data-updated="true">May 5<sup>th</sup>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="https://github.com/mrward/monodevelop-nuget-extensions">NuGet extensions addin</a> now includes a PowerShell
Core based NuGet Package Manager console for Visual Studio for Mac 8.0.</p>

<p><img src="/images/blog/NuGetPowerShellCoreConsoleVisualStudioMac8-0/NuGetPackageManagerConsoleWindow.png" title="NuGet Package Manager Console" alt="NuGet Package Manager Console window"></p>

<p>A <a href="https://lastexitcode.com/blog/2014/06/22/NuGetPowerShellConsoleForXamarinStudio/">NuGet PowerShell console</a> has been available with
the <a href="https://github.com/mrward/monodevelop-nuget-extensions">NuGet extensions addin</a> since
Xamarin Studio 5.0. Previously it used <a href="https://github.com/Pash-Project/Pash">Pash</a>, a cross-platform, open source reimplementation
of PowerShell. Pash is no longer being actively developer on after Microsoft released <a href="https://github.com/PowerShell/PowerShell">PowerShell Core</a>.
The PowerShell support in Pash was incomplete, so whilst the NuGet commands, such as Install-Package, were supported, more
complicated commands, such as those provided by <a href="https://docs.microsoft.com/en-us/ef/core/">Entity Framework Core</a>, were not supported.
Moving to PowerShell Core provides full PowerShell support, and with a partial implementation of the Visual Studio EnvDTE API,
<a href="https://docs.microsoft.com/en-us/ef/core/miscellaneous/cli/powershell">Entity Framework Core commands</a> are now supported.</p>

<p>The NuGet extensions addin runs a .NET Core console
application that hosts PowerShell Core. Communication between
the addin running in Visual Studio for Mac and the console application is through the
<a href="https://github.com/Microsoft/vs-streamjsonrpc">StreamJsonRpc</a> library.</p>

<h2>New Features</h2>

<p>The following lists the new features compared with the Pash based PowerShell console.</p>

<ul>
<li>PowerShell Core based NuGet Package Manager Console

<ul>
<li>Full PowerShell support</li>
<li>Get-Help now supported</li>
</ul>
</li>
<li>Support for Entity Framework Core NuGet commands</li>
<li>Tab completion</li>
<li>Support for stopping the executing command</li>
<li>Opening the NuGet package source configuration page from the console</li>
</ul>


<h2>Limitations</h2>

<ul>
<li><strong>Visual Studio EnvDTE API implementation is incomplete</strong></li>
</ul>


<p> The Visual Studio EnvDTE API is partially implemented. Whilst Entity Framework Core is
 supported other PowerShell scripts included with NuGet packages may not work.</p>

<ul>
<li><p><strong>Password protected NuGet package sources not supported in the following PowerShell commands:</strong></p>

<ul>
<li>Find-Package</li>
<li>Get-Package</li>
</ul>
</li>
</ul>


<p>Note that the other NuGet PowerShell commands are supported.</p>

<p>The NuGet extensions addin will not send usernames and passwords to the PowerShell Core
host console application. .NET Core also does not support decrypting passwords stored in the
NuGet.Config file.</p>

<p>The Find-Package and Get-Package commands all run completely within PowerShell hosted in the .NET Core
console application.</p>

<p>The other commands work since they run partially within Visual for Mac where actions involving password protected
NuGet package sources are supported.</p>

<ul>
<li><strong>Requires .NET Core 2.1 SDK to be installed</strong></li>
</ul>


<h2>Opening the NuGet Package Manager Console window</h2>

<p>From the View menu, select Pads, then select NuGet Package Manager Console.</p>

<p><img src="/images/blog/NuGetPowerShellCoreConsoleVisualStudioMac8-0/ViewPadsNuGetPackageManagerConsoleMenu.png" title="View - Pages - NuGet Package Manager Console menu" alt="View - Pages - NuGet Package Manager Console menu"></p>

<h2> Entity Framework Core Support</h2>

<p>The PowerShell commands provided by the
<a href="https://docs.microsoft.com/en-us/ef/core/miscellaneous/cli/powershell">Microsoft.EntityFrameworkCore.Tools NuGet package</a>
are supported in .NET Core projects.</p>

<ul>
<li>Add-Migration</li>
<li>Drop-Database</li>
<li>Get-DbContext</li>
<li>Remove-Migration</li>
<li>Scaffold-DbContext</li>
<li>Script-Migration</li>
<li>Update-Database</li>
</ul>


<p><img src="/images/blog/NuGetPowerShellCoreConsoleVisualStudioMac8-0/EntityFrameworkCoreMigrationPowerShellCommands.png" title="Package Manager Console - Entity Framework Core Add-Migration and Update-Database commands" alt="Package Manager Console - Entity Framework Core Add-Migration and Update-Database commands"></p>

<p>Note that the Entity Framework Core commands are not currently supported in projects that target the .NET Framework. This
is because the PowerShell commands attempt to directly run ef.exe that is included in the NuGet package instead of using the .NET Core ef.dll
which is used with projects that target .NET Core.</p>

<h2>Tab Completion</h2>

<p>Pressing tab in the console window will try to auto-complete the command being typed in.</p>

<p><img src="/images/blog/NuGetPowerShellCoreConsoleVisualStudioMac8-0/TabCompletionNewtonsoftJson.png" title="Tab completion - Install-Package Newtonsoft.Json" alt="Tab completion - Install-Package Newtonsoft.Json"></p>

<p><img src="/images/blog/NuGetPowerShellCoreConsoleVisualStudioMac8-0/TabCompletionPackageVersion.png" title="Tab completion - Install-Package Newtonsoft.Json -Version" alt="Tab completion - Install-Package Newtonsoft.Json -Version"></p>

<p>If there is only one match on pressing tab then the text will be inserted.</p>

<p>If there are multiple possible matches then a window will be displayed allowing an
item to be selected by pressing Tab, Enter or Return. Typing with this completion list
window open will filter the items in the list.</p>

<h2>Stopping the PowerShell command being run</h2>

<p>When a PowerShell command is being run the Stop button is enabled. The Stop button is the last button on the top right of the NuGet
Package Console window.</p>

<p><img src="/images/blog/NuGetPowerShellCoreConsoleVisualStudioMac8-0/PackageManagerConsoleStopButton.png" title="Package Manager Console stop button" alt="Package Manager Console stop button"></p>

<p>Clicking this button will attempt to stop the PowerShell command being run.</p>

<p><img src="/images/blog/NuGetPowerShellCoreConsoleVisualStudioMac8-0/PackageManagerConsolePipelineStopped.png" title="Package Manager Console pipeline stopped" alt="Package Manager Console pipeline stopped"></p>

<h2>Opening the NuGet Package Console configuration page</h2>

<p>At the top of the NuGet Package Console window there is a cog icon after the list of package sources.</p>

<p><img src="/images/blog/NuGetPowerShellCoreConsoleVisualStudioMac8-0/PackageManagerConsoleCogIcon.png" title="Package Manager Console configure sources - cog icon" alt="Package Manager Console configure sources cog icon"></p>

<p>Clicking this cog icon will open the NuGet Package Sources configuration
page which is also available from Preferences &ndash; NuGet &ndash; Sources.</p>

<h2>Installation</h2>

<p>The NuGet extensions addin is available from the Visual Studio for Mac extensions repository. To install the addin:</p>

<ul>
<li>From the main menu, open the Extensions Manager dialog.</li>
<li>Select the Gallery tab.</li>
<li>Expand IDE extensions.</li>
<li>Select NuGet Package Management Extensions 0.18 or later.</li>
<li>Click the Refresh button if the addin is not visible.</li>
<li>Click Install… to install the addin.</li>
<li>Restart Visual Studio for Mac.</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/04/20/NuGetSupportInVisualStudioMac8-0/">NuGet Support in Visual Studio for Mac 8.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-04-20T12:40:00+01:00" pubdate data-updated="true">Apr 20<sup>th</sup>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li> Fixed build action not available after installing package into a PackageReference project</li>
<li> Fixed NuGet extension api install events not raised for PackageReference projects</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 8.0</a>
can be found in the <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2019-mac-relnotes">release notes</a>.</p>

<h2>Bug Fixes</h2>

<p><strong>Fixed build action not available on installing package into a PackageReference project</strong></p>

<p>After installing the Xamarin.GooglePlayServices.Basement NuGet package, into a project
that used PackageReferences, the GoogleServicesJson build action, defined by this NuGet package,
was not available in the list of build actions when you right clicked a file in the
Solution window. The build action was available after the solution was closed and re-opened.</p>

<p>Installing a NuGet package into a project that used PackageReferences
would not re-evaluate the project&rsquo;s MSBuild information. This resulted in any custom
<a href="https://docs.microsoft.com/en-us/visualstudio/msbuild/visual-studio-integration-msbuild?view=vs-2019#additional-build-actions">AvailableItemNames</a>
not being available to be used as a build action
in the Solution window. The build actions for a project were cached so these
are now cleared to ensure the latest items are available
after an re-evaluation.</p>

<p><strong>Fixed NuGet extension api install events not raised for PackageReference projects</strong></p>

<p>The NuGet extension API has a PackageReferenceAdded event and a
PackageReferenceRemoved. These were being raised if a project had
a packages.config file but not if the project used PackageReferences.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/03/02/NuGetSupportInVisualStudioMac7-8/">NuGet Support in Visual Studio for Mac 7.8</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-03-02T12:40:00+00:00" pubdate data-updated="true">Mar 2<sup>nd</sup>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li> NuGet package diagnostics displayed in Solution window</li>
<li> Support restoring multi-target framework projects</li>
<li> Display summary of NuGet restore errors in Package Console</li>
<li> Fixed wrong version of Microsoft.AspNetCore.App being restored</li>
<li> Fixed Paket restore not working with SDK style projects</li>
<li> Fixed NuGet restore ignoring build targets</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.8</a>
can be found in the <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-mac-relnotes#whats-new-in-78">release notes</a>.</p>

<h2>NuGet package diagnostics displayed in Solution window</h2>

<p>NuGet package diagnostic warnings are now shown in the Solution window.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-8/NuGetPackageDiagnosticWarningInSolutionWindow.png" title="NuGet package diagnostic warnings in Solution Window" alt="NuGet package diagnostic warnings in Solution Window"></p>

<p>The diagnostic warnings are shown underneath the NuGet package with
a warning icon. Hovering over the warning icon will show a tooltip.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-8/NuGetPackageDiagnosticWarningTooltip.png" title="NuGet package diagnostic warning tooltip in Solution Window" alt="NuGet package diagnostic warning tooltip in Solution Window"></p>

<h2>Support restoring multi-target framework projects</h2>

<p>Projects that have multiple target frameworks now have all frameworks restored.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-8/MultiTargetProjectInSolutionWindow.png" title="Multi-target framework project restored in Solution window" alt="Multi-target framework project restored in Solution window"></p>

<p>Previously only the first target framework would be restored.</p>

<p>Conditional PackageReferences defined in the project file are also now
respected when restoring the project. Previously the conditions on the
PackageReferences would be ignored.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-8/ConditionalPackageReferences.png" title="Conditional PackageReferences restored in Solution window" alt="Conditional PackageReferences restored in Solution window"></p>

<p>Visual Studio for Mac now uses the GenerateRestoreGraphFile MSBuild target to determine
package dependencies. Previously this information was obtained from the project information
held in memory. This fixes several NuGet restore bugs in Visual Studio for Mac.</p>

<h2>Display summary of NuGet restore errors in Package Console</h2>

<p>Creating an xUnit .NET Core test project named &lsquo;xunit&rsquo; fails to
restore since there is a package reference cycle between the project
and the xunit NuGet package. Whilst this reference cycle is reported it is
hidden in the Package Console output and all you would see was a message
indicating that the restore had failed. Now the error information is
shown at the end of the
Package Console as a summary of the failures to make it easier to
see the problem.</p>

<p>Now for the xunit project you will see the following
at the end of the Package Console output:</p>

<pre><code>Cycle detected.
  xunit -&gt; xunit (&gt;= 2.3.1).
Restore failed.
</code></pre>

<h2>Bug Fixes</h2>

<p><strong>Fixed wrong version of Microsoft.AspNetCore.App being restored</strong></p>

<p>With an ASP.NET Core 2.1 project, that had included a PackageReference for
Microsoft.AspNetCore.App version 2.1.5, Visual Studio for Mac would incorrectly restore
Microsoft.AspNetCore.App version 2.1.1.</p>

<p>Using the GenerateRestoreGraphFile MSBuild target to determine package reference
information when restoring has fixed this problem.</p>

<p><strong>Fixed Paket restore not working with SDK style projects</strong></p>

<p>When Paket is used with an SDK style project it injects PackageReferences
via the PaketRestore target from the Paket.Restore.targets file. Visual Studio for
Mac was not using MSBuild to get the package reference information so
PackageReferences defined by Paket were not being restored or made available.</p>

<p><strong>Fixed NuGet restore ignoring build targets</strong></p>

<p>OrchardCore would fail to restore when opened in Visual Studio for Mac. OrchardCore
defines the PackageReference versions in a separate MSBuild .props file and has a custom
MSBuild target to define these versions. This custom MSBuild target is now supported
since Visual Studio for Mac uses the GenerateRestoreGraphFile MSBuild target to
determine package references when restoring.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2019/01/04/TaskRunnerExplorerInVisualStudioMac/">Task Runner Explorer in Visual Studio for Mac</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2019-01-04T12:00:00+00:00" pubdate data-updated="true">Jan 4<sup>th</sup>, 2019</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="https://github.com/mrward/monodevelop-language-server-addin">Task Runner Explorer addin</a> provides a
Task Runner Explorer
window, similar to the one in Visual Studio on Windows, which can be used to run tasks with
Cake, Gulp, Grunt, NPM and TypeScript.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TaskRunnerExplorerWindowGruntNpmTasks.png" title="Task Runner Explorer window" alt="Task Runner Explorer Window"></p>

<h2>Features</h2>

<ul>
<li>Task Runner Explorer Window

<ul>
<li>View tasks</li>
<li>Run tasks</li>
<li>View task output</li>
<li>Run and cancel long running tasks, such as tcs watch</li>
<li>Configure tasks to run when specific IDE events occur

<ul>
<li>Before Build</li>
<li>After Build</li>
<li>Clean</li>
<li>Project Opened</li>
<li>Solution Opened</li>
</ul>
</li>
</ul>
</li>
<li>Task Runners

<ul>
<li>Cake</li>
<li>Gulp</li>
<li>Grunt</li>
<li>NPM</li>
<li>TypeScript</li>
</ul>
</li>
</ul>


<h2>Supports</h2>

<ul>
<li>Visual Studio Mac 7.5 or later.</li>
</ul>


<h2>Task Runner Explorer</h2>

<p>To open the Task Runner Explorer window, from the View menu select Pads, then
select Task Runner Explorer.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/ViewTaskRunnerExplorerMenu.png" title="View Task Runner Explorer menu" alt="View Task Runner Explorer menu"></p>

<p>The Task Runner Explorer will look for files supported by a task runner in the
solution directory and the project directory. It will also look at all files
that have been added to a project or that have been added to a solution folder.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TaskRunnerExplorerTypeScriptNpmTasks.png" title="Task Runner Explorer TypeScript and NPM tasks" alt="Task Runner Explorer TypeScript and NPM tasks"></p>

<p>The top left of the Task Runner Explorer shows a list of projects
or the solution that have tasks available. This can be used to filter the tasks shown in the
Task Runner Explorer window.</p>

<p>Currently changes made to tasks will not be detected automatically. To refresh
the task information you can click the Refresh button
available at the top left of the Task Runner Explorer window.</p>

<h3>Running a Task</h3>

<p>To run a task you can double click it or right click and select Run.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TaskRunnerExplorerRunMenu.png" title="Task Runner Explorer Run menu" alt="Task Runner Explorer Run menu"></p>

<p>Output from the task is shown on the right hand side of the Task Runner Explorer
window.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TaskRunnerNpmUpdateRunning.png" title="NPM update running" alt="NPM update running"></p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/NpmUpdateRunCompleted.png" title="NPM update completed" alt="NPM update completed"></p>

<p>A long running task, such as tcs watch, will run until the solution is closed,
or the Stop button, available on the right hand side
of the Task Runner Explorer window, is clicked.</p>

<h3>Binding Tasks to IDE Events</h3>

<p>Tasks can be configured to run when the following IDE events occur:</p>

<ul>
<li>After Build</li>
<li>Before Build</li>
<li>Clean</li>
<li>Project or Solution Opened</li>
</ul>


<p>If the task runner file is in a project directory then the build and clean
events are associated with the project. If the task runner file is in a solution directory
then the build events are associated with the solution.</p>

<p>To configure a task, right click it, select Bindings and then select the
event.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TaskRunnerExplorerBindingsMenu.png" title="Task Runner Explorer Bindings menu" alt="Task Runner Explorer Bindings menu"></p>

<p>The binding will be displayed in the Bindings tab and will also be shown as
checked when the context menu for the task is opened.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TaskRunnerExplorerBeforeBuildBindingAdded.png" title="Task Runner Explorer Before Build binding added" alt="Task Runner Explorer Before Build binding added"></p>

<p>To remove the binding you can right click the task, select Bindings and
select the event again to uncheck it. Alternatively you can right click
it in the Bindings tab and select Remove.</p>

<p>The order in which the tasks are run for a particular IDE event can be changed
by right clicking the binding in the Bindings tab and selecting Move Up or Move Down.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TaskRunnerExplorerBindingsMoveDownMenu.png" title="Task Runner Explorer binding Move Up and Down menus" alt="Task Runner Explorer binding Move Up and Down menus"></p>

<p>The binding information is typically saved in a file in the same directory as the corresponding task
runner file, however this depends on how the task runner is implemented.</p>

<h3>Disabling Automatic Running of Tasks</h3>

<p>In preferences there is a Task Runner Explorer section which shows
a check box that can be used to enable or disable the automatic
running of tasks on opening a project or solution, and when building or cleaning.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TaskRunnerPreferences.png" title="Preferences - Automatically run tasks option" alt="Preferences - Automatically run tasks option"></p>

<h2>Cake Task Runner</h2>

<p>The Cake task runner supports running tasks defined in a build.cake file.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/CakeTaskRunner.png" title="Cake Task Runner" alt="Cake Task Runner"></p>

<p>This is based on the <a href="https://github.com/cake-build/cake-vs">Cake Task Runner for Visual Studio</a>.</p>

<h2>Gulp Task Runner</h2>

<p>The Gulp task runner supports running tasks defined in a gulpfile.js file.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/GulpTaskRunner.png" title="Gulp Task Runner" alt="Gulp Task Runner"></p>

<p><a href="https://gulpjs.com">Gulp</a> needs to be installed separately.</p>

<h2>Grunt Task Runner</h2>

<p>The Grunt task runner supports running tasks defined in a Gruntfile.js file.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/GruntTaskRunner.png" title="Grunt Task Runner" alt="Grunt Task Runner"></p>

<p><a href="https://gruntjs.com">Grunt</a> needs to be installed separately.</p>

<h2>NPM Task Runner</h2>

<p>The NPM task runner supports running tasks defined in a package.json file.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/NpmTaskRunner.png" title="NPM task runner" alt="NPM task runner"></p>

<p>The NPM task runner is a port of <a href="https://madskristensen.net/">Mads Kristensen&rsquo;s</a>
<a href="https://github.com/madskristensen/NpmTaskRunner">NPM Task Runner</a>.</p>

<p>The NPM task runner supports running with the verbose NPM option defined. If a
task is selected then a button will be displayed on the left hand side of the
Task Runner Explorer window. If this is selected then npm will be passed the
<code>-d</code> argument when it is run.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/NpmTaskRunnerVerboseButton.png" title="NPM task runner Verbose button" alt="NPM task runner Verbose button"></p>

<p>NPM needs to be installed separately.</p>

<h2>TypeScript Task Runner</h2>

<p>The TypeScript task runner supports running tcs build and tcs watch if a tsconfig.json file
is found.</p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TypeScriptTaskRunner.png" title="TypeScript task runner" alt="TypeScript task runner"></p>

<p><img src="/images/blog/TaskRunnerExplorerInVisualStudioMac/TypeScriptWatchTaskOutput.png" title="TypeScript tcs watch output" alt="TypeScript tcs watch output"></p>

<p>The TypeScript task runner will try to use tsc that is distributed with the Web Tools extension that
is included in Visual Studio for Mac. If the Web Tools extension is not installed then the task
runner will fall back to running tsc directly.</p>

<h2>Installation</h2>

<p>There are two addins to be installed:</p>

<ul>
<li><a href="https://github.com/mrward/monodevelop-task-runner-addin/releases/download/0.1/MonoDevelop.TaskRunner_0.1.mpack">Task Runner</a></li>
<li><a href="https://github.com/mrward/monodevelop-task-runner-addin/releases/download/0.1/MonoDevelop.TaskRunnersBundle_0.1.mpack">Task Runners Bundle</a></li>
</ul>


<p>The Task Runner is the main addin. This will be used by other task runner addins and provides the
main task runner API and services.</p>

<p>The Task Runners Bundle addin contains the Cake, Gulp, Grunt, NPM and TypeScript task runners. These
are currently included together as a single addin instead of being distributed separately.</p>

<p>Download both of the above .mpack files. Install the Task Runner addin first since the Task Runners Bundle
addin depends on it. To install an addin&rsquo;s .mpack file, open the Extensions Manager
by selecting Extensions&hellip; from the main menu. Click the Install from file button. Select the .mpack file
and then click the Open button. After installing both the addins restart Visual Studio for Mac.</p>

<p>These addins are not currently available from the main Visual Studio for Mac extensions server.</p>

<h2>Source Code</h2>

<ul>
<li><a href="https://github.com/mrward/monodevelop-language-server-addin">Task Runner Explorer for Visual Studio for Mac</a></li>
<li><a href="https://github.com/mrward/monodevelop-cake-task-runner">Cake Task Runner for Visual Studio for Mac</a></li>
<li><a href="https://github.com/mrward/monodevelop-grunt-task-runner">Grunt Task Runner for Visual Studio for Mac</a></li>
<li><a href="https://github.com/mrward/monodevelop-gulp-task-runner">Gulp Task Runner for Visual Studio for Mac</a></li>
<li><a href="https://github.com/mrward/NpmTaskRunner">NPM Task Runner for Visual Studio for Mac</a></li>
<li><a href="https://github.com/mrward/monodevelop-typescript-task-runner">TypeScript Task Runner for Visual Studio for Mac</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/12/19/NuGetSupportInVisualStudioMac7-7/">NuGet Support in Visual Studio for Mac 7.7</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-12-19T14:40:00+00:00" pubdate data-updated="true">Dec 19<sup>th</sup>, 2018</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li> NuGet 4.8 support</li>
<li> Support PackageReferences without a Version</li>
<li> Fixed NuGet sdk resolver not being found in Mono 5.16</li>
<li> Fixed null reference exception in package compatiblity check</li>
<li> Fixed Update menu enabled when project has no PackageReferences</li>
<li> Fixed updating a NuGet package changing a reference&rsquo;s ItemGroup</li>
<li> Fixed updating a NuGet package changing a fully qualified reference hint path to a relative path</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.7</a>
can be found in the <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-mac-relnotes#whats-new-in-77">release notes</a>.</p>

<h2>NuGet 4.8 support</h2>

<p><a href="https://docs.microsoft.com/en-us/nuget/release-notes/nuget-4.8-rtm">NuGet 4.8.0.5385</a> is now
included with Visual Studio for Mac 7.7.2.</p>

<h2>Support PackageReferences without a Version</h2>

<p>Visual Studio for Mac did not support projects that used PackageReferences without
specifying a version.</p>

<pre><code>&lt;ItemGroup&gt;
    &lt;PackageReference Include="Newtonsoft.Json" /&gt;
&lt;/ItemGroup&gt;
</code></pre>

<p>The version may be defined elsewhere in another MSBuild file, such as the Directory.props file,
or by the .NET Core SDK, as with the
Microsoft.AspNetCore.App PackageReference in ASP.NET Core projects. By default a
PackageReference without a version will restore the lowest available version for
the NuGet package.</p>

<p>However in Visual Studio for Mac there were several problems with PackageReferences that
did not specify a version.</p>

<p>Opening a project with a PackageReference without a Version
would result in an ArgumentNullException being logged and the
Add Packages dialog could not be opened.</p>

<p>If the PackageReference, in a non-SDK project, had no Version
then it was not displayed in the Packages folder and a null reference
exception was logged. The Solution window would try to find
the package to check if it was installed which is not possible
with a missing version and NuGet&rsquo;s VersionFolderPathResolver
would throw a null reference exception.</p>

<p>If a PackageReference had no Version then a null reference exception
was logged when checking for updates. A null version is now handled.</p>

<p>Right clicking the package in the Packages folder would log a
null reference exception if a non-SDK style project was used and it
had a PackageReference without a version. This is now handled and the
menu label will show &ldquo;Version None&rdquo;.</p>

<h2>Bug Fixes</h2>

<p><strong>Fixed NuGet sdk resolver not being found in Mono 5.16</strong></p>

<p>More recent versions of MSBuild, such as MSBuild 16.0.40 which is included
with Mono 5.16.0.173, allow the sdk resolver to use a manifest.xml file to
define the assembly where the resolver can be found:</p>

<pre><code>&lt;SdkResolver&gt;
  &lt;Path&gt;..\..\Microsoft.Build.NuGetSdkResolver.dll&lt;/Path&gt;
&lt;/SdkResolver&gt;
</code></pre>

<p>This manifest file not supported and resulted in the NuGet sdk resolver not
being loaded. Any projects that use an MSBuild sdk from a NuGet
package no longer worked and would result in an &lsquo;Invalid configuration
mapping&rsquo; error shown in the Solution window. The sdk resolution in
Visual Studio for Mac has now
been updated based on the latest MSBuild source code.</p>

<p><strong>Fixed null reference exception in compatiblity check</strong></p>

<p>Changing the target framework of a project that uses a packages.config
file will result in a package compatiblity check being run.
If the project had both a PackageReference and a packages.config file
the package compatiblity check would fail with a null
reference exception. Visual Studio for Mac was treating the project as
though it was using a packages.config file, when it should have been
treated as a PackageReference project. This resulted in a null
reference exception being thrown when checking for package compatiblity.</p>

<p><strong>Fixed Update menu enabled when project has no PackageReferences</strong></p>

<p>The Update menu was enabled if the project used PackageReferences but
had none in the project. Without any PackageReferences in the
project there is no packages to update. The check to determine if the Update
menu should be enabled has been changed to make sure the project has
PackageReferences in the project file, not just imported
PackageReferences. The Update
NuGet Packages menu, which is used to update packages for the solution,
has also been changed to have the same behaviour.</p>

<p><strong>Fixed updating a NuGet package changing a reference&rsquo;s ItemGroup</strong></p>

<p>On updating a NuGet package the Reference item will now be modified in
place in the project file.</p>

<p>On updating a NuGet package in a project that used a packages.config
the old NuGet package is uninstalled and the new one is installed.
This removes the old references and adds new references. If the
references are in an ItemGroup with a condition then the new
reference may be added into a different ItemGroup if there are other
ItemGroups with references. To prevent this from happening the
changes to made to references are cached and not applied to the
project until all the NuGet actions have all been run. This allows
a NuGet package update which would remove a reference and then
add a new reference to be
converted into an update of the original Reference in the project,
changing just its HintPath, so its
location in the project file is not changed.</p>

<p>This was fixed in Visual Studio for Mac 7.7.3.</p>

<p><strong>Fixed updating a NuGet package changing a fully qualified reference hint path to a relative path</strong></p>

<p>Updating a NuGet package, where the project, which uses a packages.config file,
had been modified so the
original reference had a fully qualified hint path, would result in
a relative path used for the hint path when the reference was updated.</p>

<p>Now if the original hint path was full path then if the hint
path for the reference is changed it is saved using a full
path. This is different behaviour to how Visual Studio on Windows works, which
will always add a relative hint path for the reference.</p>

<p>This was fixed in Visual Studio for Mac 7.7.3.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/10/28/ProxyTestingMacApplicationWithApache/">Proxy Testing a Mac Application with Apache</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-10-28T12:00:00+00:00" pubdate data-updated="true">Oct 28<sup>th</sup>, 2018</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here we look at using <a href="http://httpd.apache.org/">Apache</a> as
a proxy server in order to test that a Mac client application, such as Safari or Visual Studio for Mac, can make web
requests through a proxy. Enabling Basic and NTLM proxy authentication with Apache will be covered, as well as using
the Apache as a proxy without any authentication.</p>

<p>Apache will run on a separate Windows machine. Using a separate machine
allows us to check that the Mac client application is not bypassing the proxy and making direct
web requests to any server. This check can be done by configuring the local firewall to block all direct
connections out from the Mac machine but allow connections from the machine running Apache.</p>

<ul>
<li>Mac High Sierra 10.13</li>
<li><a href="https://www.apachehaus.com/cgi-bin/download.plx">Apache 2.4.35 on Windows</a></li>
</ul>


<h2>Apache Proxy &ndash; No authentication</h2>

<p>Unzip Apache and extract the files to c:\Apache24\ which is the default ServerRoot configured in the conf\httpd.conf
file.</p>

<pre><code>Define SRVROOT "/Apache24"
</code></pre>

<p>In the httpd.config file configure the port to be used by the Apache server if required.
By default port 80 is used. Here we will be using port 8888.</p>

<pre><code>Listen 8888
ServerName localhost:8888
</code></pre>

<p><a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy.html">mod_proxy</a>,
<a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_connect.html">mod_proxy_connect</a> and
<a href="https://httpd.apache.org/docs/2.4/mod/mod_proxy_http.html">mod_proxy_http</a> should be loaded.
Edit the http.conf file and ensure these modules are loaded.</p>

<pre><code>LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_connect_module modules/mod_proxy_connect.so
LoadModule proxy_http_module modules/mod_proxy_http.so
</code></pre>

<p>Add a VirtualHost and Proxy section to the httpd.conf file.</p>

<pre><code>&lt;VirtualHost *&gt;
     ProxyRequests On

    &lt;Proxy *&gt;
        Require all granted
    &lt;/Proxy&gt;
&lt;/VirtualHost&gt;
</code></pre>

<p>To run Apache, open a command prompt, change into the Apache24\bin directory, then run httpd.exe</p>

<pre><code>cd c:\Apache24\bin
httpd.exe
</code></pre>

<p>On running Apache for the first time you will see a Windows Firewall dialog.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithApache/FirewallAlertApache.png" title="Windows Firewall alert for Apache" alt="Windows Firewall alert for Apache"></p>

<p>Allow Apache to access both the private and public networks.</p>

<p>Configuring the Mac to use Apache as its proxy server can be done by opening System Preferences &ndash; Network.
For the active network select the Advanced button and open the Proxies tab. Enter the machine IP address
where Apache is running and its port into the Web Proxy (HTTP) and Secure Web Proxy (HTTPS) sections, and ensure both
of these are checked.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithApache/MacNetworkWebProxySettings.png" title="Mac web proxy settings" alt="Mac web proxy settings"></p>

<p>Finally click OK and Apply to enable the proxy settings.</p>

<p>Now http and https requests should be sent through Apache. A simple way to test this is
to open Safari and view a web page. In the C:\Apache24\logs\access.log file you should see entries for the
sites accessed.</p>

<pre><code>192.168.1.100 - - [28/Oct/2018:12:18:47 +0000] "GET http://neverssl.com/ HTTP/1.1" 200 1183
192.168.1.100 - - [28/Oct/2018:12:18:47 +0000] "GET http://neverssl.com/favicon.ico HTTP/1.1" 200 124
192.168.1.100 - - [28/Oct/2018:12:18:41 +0000] "CONNECT www.nuget.org:443 HTTP/1.1" 200 -
</code></pre>

<h2>Apache Proxy &ndash; Basic authentication</h2>

<p>To enable Basic authentication change the Proxy section in the httpd.conf file as shown below.</p>

<pre><code>&lt;VirtualHost *&gt;
     ProxyRequests On

    &lt;Proxy *&gt;
        AuthType Basic
        AuthName "Authentication required"
        AuthBasicProvider file
        AuthUserFile proxy-password.file
        Require valid-user
    &lt;/Proxy&gt;
&lt;/VirtualHost&gt;
</code></pre>

<p>Here we will be using <a href="https://httpd.apache.org/docs/2.4/programs/htpasswd.html">htpasswd.exe</a> to create a file to
store the username and password required to authenticate against
the proxy server. htpasswd.exe is in the Apache bin directory. Run the following to generate the proxy-password.file,
replacing user with the username to be used with the proxy.</p>

<pre><code>htpasswd.exe -c proxy-password.file user
</code></pre>

<p>Enter the password when prompted.</p>

<p>Copy the proxy-password.file to the Apache server&rsquo;s root directory c:\Apache24</p>

<p>To make it easier to see the basic auth header being sent you may want to enable
<a href="https://httpd.apache.org/docs/2.4/mod/mod_log_forensic.html">forensic logging</a> in Apache.
To do this add a LoadModule to the httpd.conf file.</p>

<pre><code>LoadModule log_forensic_module modules/mod_log_forensic.so
</code></pre>

<p>Define the path to the forensic log file using an IfModule.</p>

<pre><code>&lt;IfModule log_forensic_module&gt; 
    ForensicLog "logs/forensic.log"
&lt;/IfModule&gt; 
</code></pre>

<p>Run httpd.exe from the Apache24\bin directory.</p>

<p>When connecting through the proxy
for the first time the Mac will show a dialog asking for credentials.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithApache/ProxyAuthenticationRequiredDialog.png" title="Mac proxy authentication required dialog" alt="Mac proxy authentication required dialog"></p>

<p>Clicking the System Preferences button will show open a dialog where you can enter the credentials for the proxy.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithApache/ProxyCredentialsDialog.png" title="Mac proxy authentcation required - credentials dialog" alt="Mac proxy authentication required - credentials dialog"></p>

<p>Entering the credentials will result in the Mac&rsquo;s key chain being updated with the credentials associated with the proxy&rsquo;s address.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithApache/ProxyCredentialsMacKeyChain.png" title="Proxy credentials stored in Mac key chain" alt="Proxy credentials stored in Mac key chain"></p>

<p>If you open the Mac&rsquo;s Network settings you will see the Web Proxy and Secure Web Proxy settings now have a username and password
associated with them.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithApache/MacNetworkSettingsProxyUserNamePassword.png" title="Username and password associated with proxy in network settings" alt="Username and password associated with proxy in network settings"></p>

<p>In the Apache access.log you should see the requests being made and a Proxy authentication 407 status code.</p>

<pre><code>192.168.1.100 - - [28/Oct/2018:12:44:47 +0000] "CONNECT www.nuget.org:443 HTTP/1.1" 407 415
192.168.1.100 - - [28/Oct/2018:12:44:53 +0000] "GET http://neverssl.com/ HTTP/1.1" 407 415
</code></pre>

<p>In the forensic.log file you should see the basic proxy authorization header being used by the Mac.</p>

<pre><code>GET http%3a//neverssl.com/ HTTP/1.1|Host:neverssl.com|Connection:keep-alive|Proxy-Connection:keep-alive|Upgrade-Insecure-Requests:1|Proxy-Authorization:Basic MTox|Accept:text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8|User-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Safari/605.1.15|Accept-Language:en-gb|DNT:1|Accept-Encoding:gzip, deflate
CONNECT www.nuget.org%3a443 HTTP/1.1|Host:www.nuget.org%3a443|User-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Safari/605.1.15|Connection:keep-alive|Proxy-Authorization:Basic MTox|Proxy-Connection:keep-alive
</code></pre>

<h2>Apache Proxy &ndash; NTLM authentication</h2>

<p>In order to enable NTLM authentication the <a href="https://github.com/TQsoft-GmbH/mod_authn_ntlm">NTLM authentication module</a> needs to be downloaded.
Download <a href="https://www.apachehaus.com/cgi-bin/download.plx">Mod Auth NTLM for Apache 2.4.x x64 &ndash; mod_authn_ntml.zip</a>,
extract the files and copy the mod_auth_ntlm.so file to the Apache24\modules directory.</p>

<p>Add a LoadModule to the httpd.conf file for the mod_authn_ntlm.so file.</p>

<pre><code>LoadModule auth_ntlm_module modules/mod_authn_ntlm.so
</code></pre>

<p>Change the VirtualHost Proxy section as shown below:</p>

<pre><code>&lt;VirtualHost *&gt;
    ProxyRequests On

    &lt;Proxy *&gt;
        AuthType SSPI
        AuthName "Auth required"
        NTLMAuth On
        NTLMAuthoritative On

        &lt;RequireAll&gt;
            &lt;RequireAny&gt;
                Require valid-user
            &lt;/RequireAny&gt;

            &lt;RequireNone&gt;
                Require user "ANONYMOUS LOGON"
                Require user "NT AUTHORITY\ANONYMOUS LOGON"
            &lt;/RequireNone&gt;
        &lt;/RequireAll&gt;
    &lt;/Proxy&gt;
&lt;/VirtualHost&gt;
</code></pre>

<p>The username and password used to authenticate against the proxy needs to match an account on the Windows machine.
As with basic authentication, the Mac will prompt for credentials if they do not match
what is stored in the key chain for the proxy.</p>

<p>Run httpd.exe and then use Safari to open a web site to check web requests are being sent through the proxy.
You should see the Windows account being used to authenticate in Apache&rsquo;s access.log.</p>

<pre><code>192.168.1.100 - - [28/Oct/2018:13:09:19 +0000] "GET http://neverssl.com/ HTTP/1.1" 407 415
192.168.1.100 - windows\\useraccount [28/Oct/2018:13:09:19 +0000] "GET http://neverssl.com/ HTTP/1.1" 304 -
192.168.1.100 - - [28/Oct/2018:13:09:38 +0000] "CONNECT www.nuget.org:443 HTTP/1.1" 407 415
192.168.1.100 - windows\\useraccount [28/Oct/2018:13:09:12 +0000] "CONNECT www.nuget.org:443 HTTP/1.1" 200 -
</code></pre>

<p>The forensic log should show that the NTLM header is being used by the Mac.</p>

<pre><code>CONNECT www.nuget.org%3a443 HTTP/1.1|Host:www.nuget.org%3a443|User-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Safari/605.1.15|Connection:keep-alive|Proxy-Authorization:NTLM T...|Proxy-Connection:keep-alive
GET http%3a//neverssl.com/ HTTP/1.1|Host:neverssl.com|Proxy-Connection:keep-alive|Proxy-Authorization:NTLM T...|If-Modified-Since:Thu, 14 Jun 2018 00%3a16%3a40 GMT|Accept:text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8|Accept-Language:en-gb|Accept-Encoding:gzip, deflate|Content-Length:0|User-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0 Safari/605.1.15|Connection:keep-alive|Upgrade-Insecure-Requests:1|DNT:1
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/10/21/ProxyTestingMacApplicationWithFiddler/">Proxy Testing a Mac Application with Fiddler</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-10-21T12:38:00+01:00" pubdate data-updated="true">Oct 21<sup>st</sup>, 2018</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Here we look at using <a href="https://www.telerik.com/fiddler">Fiddler</a> as
a proxy server in order to test a Mac client application, such as Safari or Visual Studio for Mac, can make web
requests through the proxy. Enabling Basic proxy authentication with Fiddler will be covered, as well as using
the Fiddler as a proxy without any authentication.</p>

<p>Fiddler will run on a separate Windows machine. Using a separate machine
allows us to check that the Mac client application is not bypassing the proxy and making direct
web requests to any server. This check can be done by configuring the local firewall to block all direct
connections out from the Mac machine but allow connections from the machine running Fiddler.</p>

<ul>
<li>Mac High Sierra 10.13</li>
<li>Fiddler 5.0 on Windows</li>
</ul>


<h2>Fiddler Proxy &ndash; No authentication</h2>

<p>To enable the Mac to use Fiddler as its proxy first configure Fiddler to allow remote connections.
This can be done by open the Tools menu, selecting Options, opening the Connections tab, and
checking <a href="http://docs.telerik.com/fiddler/Configure-Fiddler/Tasks/MonitorRemoteMachine">Allow remote computers to connect</a>.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/FiddlerRemoteConnections.png" title="Fiddler allow remote connections" alt="Fiddler allow remote connections"></p>

<p>Configuring the Mac to use Fiddler as its proxy server can be done by opening System Preferences &ndash; Network.
For the active network select the Advanced button and open the Proxies tab. Enter the Fiddler&rsquo;s machine IP address and
port into the Web Proxy (HTTP) and Secure Web Proxy (HTTPS) sections, and ensure both
of these are checked.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/MacNetworkWebProxySettings.png" title="Mac web proxy settings" alt="Mac web proxy settings"></p>

<p>Finally click OK and Apply to enable the proxy settings.</p>

<p>Now http and https requests should be sent through Fiddler. A simple way to test this is
to open Safari and open a web page.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/FiddlerNuGetHttpsRequest.png" title="Fiddler https request recorded" alt="Fiddler https request recorded"></p>

<h2>Fiddler Proxy &ndash; Basic authentication</h2>

<p>To enable Basic proxy authentication in Fiddler open the Rules menu and ensure that
Require Proxy Authentication is checked.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/FiddlerProxyAuthEnabled.png" title="Fiddler require proxy authentication option" alt="Fiddler require proxy authentication option"></p>

<p>This will result in Fiddler requiring Basic authentication with a username &lsquo;1&rsquo; and a
password &lsquo;1&rsquo;.</p>

<p>Unfortunately it seems that the native Mac networking API does not work with Fiddler
for https requests but will work for non-secure http requests. Opening a web page in Safari will cause the Mac to prompt for
the proxy credentials.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/ProxyAuthenticationRequiredDialog.png" title="Mac proxy authentication required dialog" alt="Mac proxy authentication required dialog"></p>

<p>Clicking the System Preferences button will show open a dialog where you can enter the credentials for the proxy.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/ProxyCredentialsDialog.png" title="Mac proxy authentcation required - credentials dialog" alt="Mac proxy authentication required - credentials dialog"></p>

<p>Entering the credentials will result in the Mac&rsquo;s key chain being updated with the credentials associated with the proxy&rsquo;s address.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/ProxyCredentialsMacKeyChain.png" title="Proxy credentials stored in Mac key chain" alt="Proxy credentials stored in Mac key chain"></p>

<p>If you open the Mac&rsquo;s Network settings you will see the Web Proxy and Secure Web Proxy settings now have a username and password
associated with them.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/MacNetworkSettingsProxyUserNamePassword.png" title="Username and password associated with proxy in network settings" alt="Username and password associated with proxy in network settings"></p>

<p>Safari will display an error page when accessing a web page over https when the Mac is configured to use Fiddler&rsquo;s basic authentation proxy.</p>

<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/SafariProxyServerError.png" title="Safari 310 proxy error" alt="Safari 310 proxy error"></p>

<p>It seems that for a https request the Mac sends the request with two keep alive headers:</p>

<ul>
<li>Connection: keep-alive</li>
<li>Proxy-Connection: keep-alive</li>
</ul>


<p>Fiddler responds with a 407 proxy authentication required response and a close
header.</p>

<ul>
<li>Connection: close</li>
</ul>


<p><img src="/images/blog/ProxyTestingMacApplicationWithFiddler/FiddlerProxyAuthHttpsRequestDenied.png" title="Fiddler https request denied" alt="Fiddler https request denied"></p>

<p>Since the keep-alive is not being honoured by Fiddler the web request sent from the Mac fails and an kCFErrorDomainCFNetwork 310
error occurs. This maps to the kCFErrorHTTPSProxyConnectionFailure status code.</p>

<p>Other applications that do not use the native Mac networking API, such as the Google Chrome web browser,
will work with Fiddler and will prompt for credentials.</p>

<p>Unfortunately you currently cannot use Fiddler with basic proxy authentication enabled to test
a Mac application making https requests. As an alternative you can use another proxy server, such as Apache.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/09/02/NetCoreSupportInVisualStudioMac7-6/">.NET Core Support in Visual Studio for Mac 7.6</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-09-02T11:00:00+01:00" pubdate data-updated="true">Sep 2<sup>nd</sup>, 2018</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li>NuGet SDK resolver now used to find NuGet SDK packages</li>
<li>Fixed Synchronous operation cancelled message on stopping debugging</li>
<li>Fixed debugger hanging when debugging unit tests</li>
<li>Fixed command line arguments not used with a new project</li>
<li>Fixed hang when discovering unit tests</li>
<li>Allow loading of SDK style projects without a main PropertyGroup</li>
<li>Fixed TargetFramework not being updated in project</li>
<li>Fixed .xaml.cs code completion in new Xamarin.Forms .NET Standard project</li>
<li>Fixed default build action for new HTML file</li>
<li>Fixed SDK version not being parsed from Sdk attribute</li>
<li>Fixed null reference on opening .NET Core project with sdk version</li>
<li>Fixed editor errors when .NET Standard assembly referenced in Xamarin.iOS project</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.6</a>
can be found in the <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-mac-relnotes#whats-new-in-76">release notes</a>.</p>

<h2>NuGet SDK resolver now used to find NuGet SDK packages</h2>

<p>Visual Studio for Mac now has support for the
<a href="https://github.com/Microsoft/msbuild/issues/2803">NuGet SDK resolver</a>. The NuGet
SDK resolver will download and install SDKs for SDK style
projects if these SDKs are missing.</p>

<pre><code>&lt;Project Sdk="My.Custom.Sdk/2.3.4"&gt;
  ...
&lt;/Project&gt;
</code></pre>

<p>The SDK resolution is done in the background
when the project is opened and there is currently no visual indication that
this is happening.</p>

<p>The NuGet library assemblies are not available to the remote MSBuild host used by
Visual Studio for Mac so the NuGet SDK resolver was previously failing to load. The NuGet SDK
resolver supports a MSBUILD_NUGET_PATH environment variable which is now set by
Visual Studio for Mac to point to the directory containing the NuGet assemblies
that are included with the IDE.</p>

<h2>Bug Fixes</h2>

<p><strong>Fixed synchronous operation cancelled message on stopping debugging</strong></p>

<p>Stopping the .NET Core debugger would sometimes result in
a dialog being displayed indicating that the debugger operation failed.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-6/DebuggerOperationFailedMessage.png" title="Debugger operation failed - Synchronous operation cancelled - dialog" alt="Debugger operation failed - Synchronous operation cancelled - dialog"></p>

<p><strong>Fixed debugger hanging when debugging unit tests</strong></p>

<p>The .NET Core debugger would sometimes hang Visual Studio for Mac when debugging unit tests.
The problem was that if the breakpoint was placed on an invalid line then the .NET Core debugger
would send back the adjusted breakpoint location. Visual Studio for Mac would then send back
an incorrect breakpoint line back to the .NET Core debugger, which again resulted in the debugger
sending back a corrected line. This would repeat resulting in the IDE and debugger
getting stuck in a loop.</p>

<p><strong>Fixed command line arguments not used with a new project</strong></p>

<p>Creating a new .NET Core console project, editing the project run
configuration to use extra command line arguments, or to not use the
external console, then building and running the project would result
in the project run configuration not being used. No extra
arguments would be passed to the console project, and the external
console would still be used. This could be fixed by closing and
re-opening the solution.</p>

<p>The problem was that when the project is re-evaluated, after it is
created, its run configurations are cleared. The solution&rsquo;s
startup run configuration would still be using
the original project run configuration that was no longer used.
Changes made to the project run configuration then had no affect. Closing and
re-opening the solution fixed this since
the run configuration defined in the .csproj.user file is re-used when the
project is re-evaluated on reloading so both the solution run configuration and
the project run configuration refer to the same configuration. To fix this,
on re-evaluating the project, if the solution&rsquo;s run configuration
refers to a project run configuration that has been removed then
the solution&rsquo;s startup configuration is refreshed.</p>

<p>Note that there is a similar problem with multiple solution run
configurations that can occur which is not addressed by this fix.</p>

<p><strong>Fixed hang when discovering unit tests</strong></p>

<p>Opening a solution containing a .NET Core test project would sometimes
result in the IDE hanging when discovering tests. On running <code>kill -QUIT pid</code>
the IDE log would show a background thread and the UI thread both
awaiting test discovery to complete:</p>

<pre><code>var discoveredTests = await VsTestDiscoveryAdapter.Instance.DiscoverTestsAsync (Project);

VsTestProjectTestSuite/&lt;OnCreateTests&gt;d__12.MoveNext
in MonoDevelop.UnitTesting.VsTest/VsTestProjectTestSuite.cs:95
</code></pre>

<p><strong>Allow loading of SDK style projects without a main PropertyGroup</strong></p>

<p>On loading an SDK style project that did not have a main PropertyGroup
Visual Studio for Mac would show the error message
&ldquo;Error while trying to load project:
Object reference not set to an instance of an object&rdquo;.</p>

<p>A project may define MSBuild properties in a Directory.Build.props file
instead of having this in the main project file. It is then
possible for the main project file to have no main property group.</p>

<p>Directory.Build.props:</p>

<pre><code>&lt;Project&gt;
  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;netcoreapp2.1&lt;/TargetFramework&gt;
  &lt;/PropertyGroup&gt;
&lt;/Project&gt;
</code></pre>

<p>MainProject.csproj:</p>

<pre><code>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
&lt;/Project&gt;
</code></pre>

<p>Visual Studio for Mac now handles the missing main PropertyGroup.</p>

<p><strong>Fixed TargetFramework not being updated in project</strong></p>

<p>Changing a .NET Core project&rsquo;s target framework to a different version in
Project Options, then re-opening Project Options and changing the
target framework version back again, would result in the target framework
not being updated in the project. The problem was the original target framework the
project had on opening was cached and the changing back to the same
target framework version was being ignored resulting in the project file not
being updated.</p>

<p><strong>Fixed .xaml.cs code completion in new Xamarin.Forms .NET Standard project</strong></p>

<p>Creating a new Xamarin.Forms .NET Standard project, then
modifing the .xaml to add new named UI items, would result in no
code completion in the .xaml.cs file for these new items
until the solution was closed and re-opened. The problem was that the
.xaml and .xaml.cs files
were being removed from the file information held in memory
when the project was re-evaluated. On re-evaluation, after
the NuGet restore is first run for the project, the old MSBuild items for the
.xaml and .xaml.cs file have the wrong metadata, so they need
to be removed, whilst new MSBuild items with the updated metadata
need to be added. The removal was done after adding the updated files
and, since they had the same filename, the new updated files were being
removed. The removal is now done before adding the updated files to
avoid the files being removed incorrectly.</p>

<p><strong>Fixed default build action for new HTML file</strong></p>

<p>Adding a new .html file to the wwwroot folder of an ASP.NET Core
project would add the file as a None item instead of a Content
item. This would result in the .html file not being used when
publishing the project. When &lsquo;dotnet publish&rsquo; was used the
publish directory would not contain the .html file.</p>

<p>ASP.NET Core projects have different build actions for files based on where they
are added. A .html file in the root directory would be a None item by default,
whilst a .html file in the wwwroot directory would be a Content item
by default. To fix this the default build action for a file is
determined by the file wildcard information available from the .NET
Core SDK.</p>

<p><strong>Fixed SDK version not being parsed from Sdk attribute</strong></p>

<p>The Sdk attribute would have its forward slash / replaced with a
backslash \ which meant Visual Studio for Mac was creating an
SdkReference with the wrong name, for example:</p>

<pre><code>Microsoft.NET.Sdk.Razor\2.1.0-preview2-final
</code></pre>

<p>Instead of having Microsoft.NET.Sdk.Razor as the name with the
version being separate.</p>

<p><strong>Fixed null reference on opening .NET Core project with SDK version</strong></p>

<p>Opening a SDK style project that used a Sdk attribute with a version
would show an error message &ldquo;Error while trying to load project:
Object reference not set to an instance of an object&rdquo;. The problem
was that an SdkResolver can return null from its Resolve method.
These null results were added to a list and then an attempt was made
to log the result warnings on a null result.</p>

<pre><code>&lt;Project Sdk="Microsoft.NET.Sdk.Razor/2.1.0-preview2-final"&gt;
</code></pre>

<p><strong>Fixed editor errors when .NET Standard assembly referenced in Xamarin.iOS project</strong></p>

<p>When a Xamarin.iOS project used an assembly that was compiled
for .NET Standard, such as the assembly in the
System.Collections.Immutable NuGet package, the netstandard assembly
was not made available for code completion. This then resulted in the text editor
showing errors even though the project could be compiled succesfully.
The errors displayed were similar to:</p>

<pre><code>  The type 'ValueType' is defined in an assembly that is not
  referenced. You must add a reference to assembly 'netstandard,
  Version=2.0.0.0, Culture=neutral, PublicKeytoken=cc7b1dffcd2ddd51'.
</code></pre>

<p>Now a check is made to determine
if an assembly is referencing netstandard and if so the facade assemblies,
which for Xamarin.iOS will include the netstandard.dll, are made available
for code completion. Previously only a check was made for the project having
an assembly referencing System.Runtime before including the facade assemblies.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/09/01/NuGetSupportInVisualStudioMac7-6/">NuGet Support in Visual Studio for Mac 7.6</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-09-01T14:20:00+01:00" pubdate data-updated="true">Sep 1<sup>st</sup>, 2018</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li> Support no-op package restore on opening a solution</li>
<li> Added basic support for the NuGet SDK resolver</li>
<li> Fixed source code transformations not available in code completion</li>
<li> Fixed incorrect FSharp.Core NuGet package being restored</li>
<li> Fixed updating PackageReference removing metadata</li>
<li> Fixed build error after updating Xamarin.Forms PackageReference</li>
<li> Fixed build error after updating Xamarin.Forms NuGet package</li>
<li> Fixed editor errors when .NET Standard assembly referenced in Xamarin.iOS project</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.6</a>
can be found in the <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-mac-relnotes#whats-new-in-76">release notes</a>.</p>

<h2>Support no-op package restore on opening a solution</h2>

<p>On opening a solution a NuGet package restore was always run for projects that use
PackageReferences. This resulted in the project.assets.json file being
re-generated and the projects being re-evaluated. Now if the package
references have not changed a no-op restore will occur. This makes the
restore faster on opening a solution. It also prevents Visual Studio for Mac
going online to fetch NuGet package information if a wildcard is used for
a PackageReference or if the package version cannot be found. In the Package
Console when a no-op restore occurs you will see the following
messages:</p>

<pre><code>Assets file has not changed. Skipping assets file writing.
No-Op restore. The cache will not be updated.
</code></pre>

<h2>Allow NuGet SDK resolver to find NuGet SDK packages</h2>

<p>Visual Studio for Mac now has basic support for the
<a href="https://github.com/Microsoft/msbuild/issues/2803">NuGet SDK resolver</a>. The NuGet
SDK resolver will download and install SDKs for SDK style
projects if these SDKs are missing.</p>

<pre><code>&lt;Project Sdk="My.Custom.Sdk/2.3.4"&gt;
  ...
&lt;/Project&gt;
</code></pre>

<p>The SDK resolution is done in the background
when the project is opened and there is currently no visual indication that
this is happening.</p>

<p>The NuGet library assemblies are not available to the remote MSBuild host used by
Visual Studio for Mac so the NuGet SDK resolver was previously failing to load. The NuGet SDK
resolver supports a MSBUILD_NUGET_PATH environment variable which is now set by
Visual Studio for Mac to point to the directory containing the NuGet assemblies
that are included with the IDE.</p>

<h2>Bug Fixes</h2>

<p><strong>Source code transformations not available in code completion</strong></p>

<p>Visual Studio for Mac now ensures that files generated by a NuGet
package are available for code completion. One example
NuGet package that generates files is the
<a href="https://www.nuget.org/packages/LibLog/">LibLog NuGet package</a>.</p>

<p>The LibLog NuGet package has contentFiles that are processed by
MSBuild and converted into .cs files. These .cs files are implicitly included
in the project. These files are generated in the obj folder. For example:</p>

<pre><code>obj/Debug/netstandard2.0/NuGet/SomeID/LibLog/5.0.0/ILog.cs
</code></pre>

<p>The types defined inside these generated files can be referenced by
code in the project. Whilst the project would compile without any errors
the text editor would show errors about the
types from the generated files being undefined.</p>

<p>These generated files are not created or returned by running the
CoreCompileDependsOn MSBuild target, which is currently used to find generated
files. Now when the CoreCompileDependsOn target is evaluated, Visual Studio for
Mac will also run NuGet specific
MSBuild targets to ensure any NuGet package files are generated and
made available for code completion.</p>

<p><strong>Fixed incorrect FSharp.Core NuGet package restored</strong></p>

<p>Installing the FSharp.Core
4.5.0 NuGet package into a F# .NET Core console project would result in
version 4.3.4 of the FSharp.Core NuGet
package being used and displayed in the Dependencies folder. FSharp.Core 4.3.4 is
the NuGet package implicitly added by the F# .NET Core SDK. This was being used by
the project instead of the PackageReference defined in the project.
PackageReferences in the project will now override any implicitly
added NuGet packages. This matches the behaviour of dotnet restore when
run from the command line.</p>

<p><strong>Fixed updating PackageReference removing metadata</strong></p>

<p>On updating a NuGet PackageReference the old PackageReference was
removed from the project file and then a new PackageReference was added.
This resulted in custom MSBuild properties associated with the
PackageReference being removed from the project file.</p>

<pre><code>&lt;PackageReference Include="NuGet.Versioning" Version="3.6.0"&gt;
  &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;
&lt;/PackageReference&gt;  
</code></pre>

<p>Now on updating a NuGet package the version of the existing PackageReference element
is updated so any custom MSBuild properties are not removed.</p>

<p><strong>Fixed build error after updating Xamarin.Forms PackageReference</strong></p>

<p>A build error could occur after updating projects that had
a Xamarin.Forms PackageReference. One way to reproduce this was to
have a .NET Standard project that used an old Xamarin.Forms
version as a PackageReference, and another non .NET Core project,
that references the .NET Standard project, which used a newer
Xamarin.Forms NuGet package. On building an
error would be displayed:</p>

<pre><code>Error XF002: Xamarin.Forms tasks do not match targets
</code></pre>

<p>On updating the .NET Standard project to use the same Xamarin.Forms
NuGet package version the build error would still occur until the solution
was closed and re-opened. Now the remote MSBuild host is shutdown
to ensure the correct Xamarin.Forms MSBuild targets and assemblies
are used after the NuGet package is updated.</p>

<p><strong>Fixed build error after updating Xamarin.Forms NuGet package</strong></p>

<p>On updating the Xamarin.Forms NuGet package in a solution
the build would sometimes fail with errors similar to:</p>

<pre><code>Could not load file or assembly 'Xamarin.Forms.Xaml,
Version=2.0.0.0, Culture=neutral, PublicKeyToken=null' or one of
its dependencies.

Error XF002: Xamarin.Forms tasks do not match targets. Please
ensure that all projects reference the same version of
Xamarin.Forms, and if the error persists, please restart the IDE.
</code></pre>

<p>The problem was that the old MSBuild tasks and targets from the originally used
Xamarin.Forms NuGet package were
still being used. Now when an MSBuild import has changed in a project
the remote MSBuild host is shutdown to ensure the correct MSBuild tasks are
used.</p>

<p><strong>Fixed editor errors when .NET Standard assembly referenced in Xamarin.iOS project</strong></p>

<p>When a Xamarin.iOS project used an assembly that was compiled
for .NET Standard, such as the assembly in the
System.Collections.Immutable NuGet package, the netstandard assembly
was not made available for code completion. This then resulted in the text editor
showing errors even though the project could be compiled succesfully.
The errors displayed were similar to:</p>

<pre><code>  The type 'ValueType' is defined in an assembly that is not
  referenced. You must add a reference to assembly 'netstandard,
  Version=2.0.0.0, Culture=neutral, PublicKeytoken=cc7b1dffcd2ddd51'.
</code></pre>

<p>Now a check is made to determine
if an assembly is referencing netstandard and if so the facade assemblies,
which for Xamarin.iOS will include the netstandard.dll, are made available
for code completion. Previously only a check was made for the project having
an assembly referencing System.Runtime before including the facade assemblies.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2018/05/20/NetCoreSupportInVisualStudioMac7-5/">.NET Core Support in Visual Studio for Mac 7.5</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2018-05-20T09:00:00+01:00" pubdate data-updated="true">May 20<sup>th</sup>, 2018</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>New Features</h2>

<ul>
<li>.NET Core 2.1 SDK support

<ul>
<li>.NET Core 2.1 SDK project templates</li>
<li>HTTPS development certificate support</li>
<li>.NET Core global tools added to PATH on startup</li>
</ul>
</li>
<li>.NET Core location can now be configured</li>
<li>Xamarin.Forms project templates now use .NET Standard projects</li>
<li>Performance improvements when using projects with many files</li>
<li>.NET Core templating engine has been updated</li>
<li>Improved support for Xamarin.Forms</li>
<li>Item templates are now supported with the .NET Core templating engine</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.5</a> can be found in the
<a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-mac-relnotes#-visual-studio-2017-for-mac-version-75-release-notes">release notes</a>.</p>

<h2>.NET Core 2.1 SDK support</h2>

<p>Visual Studio for Mac 7.5 includes support for the .NET Core 2.1 SDK which is currently
available as a <a href="https://blogs.msdn.microsoft.com/dotnet/2018/05/07/announcing-net-core-2-1-rc-1/">release candidate</a>. The following
sections will look into the support provided by Visual Studio for Mac 7.5 for the .NET Core 2.1 SDK.</p>

<h3>.NET Core 2.1 SDK project templates</h3>

<p>If .NET Core 2.1.300 SDK is installed then the .NET Core 2.1 project templates
will be available in the New Project dialog.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/NewProjectDialogNetCore21TargetFramework.png" title="New Project dialog - .NET Core 2.1 target framework option" alt="New Project dialog - .NET Core 2.1 target framework option"></p>

<p>The .NET Core 2.1 project templates are not included with Visual Studio for Mac and
will be searched for in the 2.1.300 SDK templates directory.</p>

<pre><code>/usr/local/share/dotnet/sdk/2.1.300-rc1-008673/Templates/
</code></pre>

<p>The project templates for .NET Core 2.0 and 1.1 are currently still being shipped
with Visual Studio for Mac.</p>

<h3>HTTPS development certificate support</h3>

<p>ASP.NET Core 2.1 projects use HTTPS by default. In order to be able to run
ASP.NET Core 2.1 projects with HTTPS a development certificate needs to be installed.
Visual Studio for Mac will detect if the development certificate is missing
and offer to install it when you run an ASP.NET Core 2.1 project that uses
HTTPS.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/HttpsDevCertificateNotInstalledMessage.png" title="HTTPS development certificate not installed message" alt="HTTPS development certificate not installed message"></p>

<p>Visual Studio for Mac will use the dotnet dev-certs tool to check if the
HTTPS development certificate is installed and trusted.</p>

<pre><code>dotnet dev-certs https --trust --check
</code></pre>

<p>Installing the HTTPS certificate requires administrator privileges so you may be
prompted for your username and password after clicking the Yes button. Currently
the prompt for credentials shows <strong>mono-sgen64 wants to make changes</strong>. In the future this will show a
custom message indicating that the credentials are required to install the HTTPS development certificate.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/MonoSGenAdminPrompt.png" title="Mono sgen administrator dialog prompt" alt="Mono sgen administrator dialog prompt"></p>

<p>After entering your credentials the following command is run as administrator.</p>

<pre><code>dotnet dev-certs https --trust
</code></pre>

<p>After the certificate is installed the ASP.NET Core 2.1 project will be
opened in the default browser using HTTPS.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/AspNetCoreProjectInChromeUsingHttps.png" title="ASP.NET Core 2.1 project open in browser using HTTPS" alt="ASP.NET Core 2.1 project open in browser using HTTPS"></p>

<p>Running <strong>dotnet dev-certs https &mdash;trust</strong> to install and trust the certificate needs to be
done with administrator privileges with the user id 0. To do this Visual Studio for Mac
does the following:</p>

<ol>
<li>Launches a separate custom console app.</li>
<li>The console app uses the AuthorizationExecuteWithPrivileges Mac
API provided by Xamarin.Mac to launch itself as again as administrator.
It is not possible to run dotnet as administrator initially since it requires the user id to be
set to 0, which is what happens when you use <strong>sudo dotnet</strong>, and this can only be done
when running with administrator privileges. So the console app is launched again but this
time with administrator privileges.</li>
<li>The console app, now being run with administrator privileges, will use setuid to set the
current user id to 0.</li>
<li>The console app then runs <strong>dotnet dev-certs https &mdash;trust</strong> which
will install and trust the HTTPS development certificate.</li>
</ol>


<p>The <strong>dotnet dev-certs https &mdash;trust</strong> command will add two localhost certificates. You
can see these by opening the Keychain Access application and searching for
localhost.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/LocalhostCertificateInKeychain.png" title="localhost certificate created by dotnet dev-certs in Keychain Access application" alt="localhost certificate created by dotnet dev-certs in Keychain Access application"></p>

<p>If the HTTPS development certificate is found to be valid and
trusted then this will be remembered for the current Visual Studio for Mac
session and a check will not be run again during the current session.</p>

<h3>.NET Core global tools added to path on startup</h3>

<p>The .NET Core SDK 2.1 supports installing global tools. These tools are .NET Core console apps
that are available as NuGet packages and can be installed and used from the command line.
To be able to use these tools with the dotnet command line the <strong>~/.dotnet/tools</strong>
directory needs to be added to the PATH environment variable. The path to
these global tools is now added to Visual Studio&rsquo;s PATH environment variable
when it starts.</p>

<h3>Prompt to install .NET Core 2.1 SDK if not installed</h3>

<p>If a .NET Core 2.1 project is opened and .NET Core 2.1.300 SDK is not
installed then a dialog will be shown allowing the SDK to
be downloaded. The project in the Solution window will show an error
icon indicating that the .NET Core 2.1 SDK is not
installed.</p>

<h3>Launching a browser when running an ASP.NET Core 2.1 project</h3>

<p>The .NET Core SDK 2.1 project templates for ASP.NET Core
specify the https and http urls in the launchSettings.json file
by using the applicationUrl property.</p>

<pre><code>    "MyAspNetCore21Project": {
        "commandName": "Project",
        "launchBrowser": true,
        "applicationUrl": "https://localhost:5001;http://localhost:5000",
        "environmentVariables": {
            "ASPNETCORE_ENVIRONMENT": "Development"
        }
    }
</code></pre>

<p>With earlier .NET Core 2.1 preview SDKs this was defined in the
ASPNETCORE_URLS environment variable. The full applicationUrl
property was used unmodified when running the ASP.NET Core 2.1 project and
resulted in an invalid url being used causing the AspNetCoreExecutionHandler to log a warning
and not opening the browser. Now the first url in the applicationUrl
is used if there are multiple urls.</p>

<h3>Support ASPNETCORE_URLS when launching the browser</h3>

<p>If the launchSettings.json does not define an applicationUrl then
Visual Studio for Mac will fallback to checking the environment variable defined
for ASPNETCORE_URLS in the launchSettings.json file and will use the first url
found there. This url will be used to launch the browser when running the project.</p>

<p>An example launchSettings.json that was used in the .NET Core 2.1 preview SDKs
is shown below.</p>

<pre><code>"MyProject": {
  "commandName": "Project",
  "launchBrowser": true,
  "environmentVariables": {
    "ASPNETCORE_ENVIRONMENT": "Development",
    "ASPNETCORE_URLS": "https://localhost:5001;http://localhost:5000"
  }
}
</code></pre>

<p>Compared with the .NET Core SDK 2.0.</p>

<pre><code>"MyProject": {
  "commandName": "Project",
  "launchBrowser": true,
  "environmentVariables": {
    "ASPNETCORE_ENVIRONMENT": "Development"
  },
  "applicationUrl": "http://localhost:5000/"
}
</code></pre>

<h2>Allow .NET Core location to be configured</h2>

<p>In Preferences there is now a Projects &ndash; SDK Locations &ndash; .NET Core
section that can be used to configure the location of the .NET Core
command line tool (dotnet).</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/NetCoreLocationConfiguration.png" title=".NET Core location configured in preferences" alt=".NET Core location configured in preferneces"></p>

<p>This can be used to configure Visual Studio for Mac to use a
.NET Core SDK that is not installed in the default location. After this is
changed the MSBuild engine hosts are recycled and all .NET Core projects
are re-evaluated to ensure the new locations of any MSBuild targets
are used.</p>

<p>If the location is invalid, or no runtimes or SDKs can be found at the configured
location, a Not found error will be displayed.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/NetCoreLocationInvalidPath.png" title="Invalid .NET Core location path specified in preferences" alt="Invalid .NET Core location path specified in preferences"></p>

<h2>Xamarin.Forms Project Templates now include .NET Standard projects</h2>

<p>The Xamarin.Forms project templates, Blank Forms App and Forms App, will now
create a .NET Standard 2.0 project instead of a Portable Class Library (PCL) project
if .NET Standard is selected in the New Project dialog.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/NewProjectDialogFormsNetStandard.png" title="New Project dialog - Blank Forms - .NET Standard option" alt="New Project dialog - Blank Forms - .NET Standard option"></p>

<p>The Xamarin.Forms Class Library project template now creates a .NET Standard 2.0 project instead of
a Portable Class Library project.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-5/NewProjectDialogXamarinFormsLibraryProject.png" title="New Project dialog - Xamarin.Forms Class Library project" alt="New Project dialog - Xamarin.Forms Class Library project"></p>

<h2>Prevent .xaml.cs file from being renamed in a .NET Core project</h2>

<p>The Xamarin.Forms NuGet package has an MSBuild .targets file that is imported
after the project items are defined. This .targets file overrides
the DependentUpon property for all .xaml.cs files. This means that renaming the
.xaml.cs file to be different to the .xaml file is not supported.
To prevent this the Rename menu is now disabled in the Solution
window for .xaml.cs files if they depend on a .xaml file.</p>

<h2>Exclude None build action for XAML files in .NET Core projects</h2>

<p>Recent versions of Xamarin.Forms NuGet packages exclude all .xaml files from the
default None file wildcard defined by the .NET Core SDK. This exclusion is
done in a .targets file which is applied after the items in the project
file have been added. This means that a .NET Standard project should not use
None items for .xaml files since they will be removed. To avoid this problem
the None build action is excluded from the list of build actions for .xaml files.
This list of build actions is available when right
clicking the file in the Solution window and in the Properties window when
the file is selected.</p>

<h2>Dependent files now renamed on renaming parent file in the Solution window</h2>

<p>When a file is renamed in the Solution window the dependent files will
also be renamed if they start with the same name as the parent file.
This avoids problems with XAML files since a different name for the .xaml file
and the associated .xaml.cs file is not supported.</p>

<h2>Improve project load times for projects with many files</h2>

<p>Opening a .NET Core project that contained many files that
were not excluded, such as a .NET Core console project that has a
node_modules directory, could take a long time to load.</p>

<p>Some performance improvements have been made to speed up the
loading of .NET Core projects. For a .NET Core console project that had a node_modules
directory containing around 17000 files the initial project load time which
was taking around 70-80 seconds and now it takes around 20 seconds. Visual Studio 2017 on
Windows takes around 15-20 seconds to load the same project before
it is visible in the Solution Explorer window.</p>

<p>The performance improvements include:</p>

<ol>
<li>Adding a faster project item lookup used when finding an existing
project item on loading the project.</li>
<li>Updating the existing project items is now faster avoiding iterating
over the existing items.</li>
<li>Evaluating MSBuild items is now only done when evaluating properties.
Previously this was done when evaluating project configurations and run configurations.
This would result in
files and directories being searched multiple times when looking
wildcard matches on loading the project. Now the files
and directories are searched once during the initial project load.</li>
</ol>


<h2>.NET Core templating engine updated</h2>

<p>Updated the .NET Core templating to version 1.0.0-beta3-20171117-314. This new
version of the .NET Core templating engine fixes the following problems:</p>

<ol>
<li>Templates that use files with @ character in their names being generated with the
@ symbol encoded.</li>
<li>Templates that use the Guid macro and did not specify a format
would cause the template generation to fail. An exception was thrown
since the format was not defined. Now
if the format is not defined the default format is used.</li>
</ol>


<h2>Report template creation failures when using the .NET Core templating engine</h2>

<p>To help diagnose problems with project and item templates that use the
.NET Core templating engine more detailed information about the failure is now logged
in the IDE log.</p>

<h2>Support item templates with the new templating engine</h2>

<p>Item templates that use the .NET Core
templating engine can be defined through a new extension point.</p>

<pre><code>&lt;Extension path="/MonoDevelop/Ide/ItemTemplates"&gt;
        &lt;Template
                id="Azure.Function.CSharp.BlobTrigger"
                _overrideName="Blob Trigger"
                path="Templates/Azure.Functions.Templates.nupkg" /&gt;
&lt;/Extension&gt;
</code></pre>

<p>Item templates are not currently supported in the New File dialog however there
is an API that can be used by extensions to create files from these templates.
This is currently used when adding a new Azure Function to a project.</p>

<h2>Bug Fixes</h2>

<p><strong>Missing child package dependencies in Solution window</strong></p>

<p>After creating a new ASP.NET Core project sometimes the package dependencies
shown in the Solution window under the SDK folder and the NuGet folder
could not be expanded to view the child dependencies.</p>

<p>The problem was that if the call to get the package dependencies
using MSBuild was cancelled this would result an empty list of depenencies
being cached. Since no package dependencies were returned the Solution window
would fallback to showing the package dependencies that were listed in the
project and a default top level SDK package dependency.</p>

<p><strong>MSBuild wildcards being expanded on saving a project</strong></p>

<p>Saving a project with a file wildcard that had a Link with
MSBuild item metadata, as shown below, would result in the wildcard
being removed and replaced with MSBuild items for each file included
by the wildcard.</p>

<pre><code>&lt;Compile Include="**\*.cs" Exclude="obj\**"&gt;
  &lt;Link&gt;%(RecursiveDir)%(Filename).cs&lt;/Link&gt;
&lt;/Compile&gt;
</code></pre>

<p>The problem was that the evaluated Link property value was being
compared with the unevaluated value, which did not match, resulting
in the wildcard being replaced with individual MSBuild items for
each file. Now if the property value contains a % character a comparison is
made against the evaluated value when checking if the project item
has changed.</p>

<p><strong>MSBuild items added for wildcards with link metadata on saving project</strong></p>

<p>A project containing the following MSBuild file wildcards would have
extra MSBuild items added when the project file was saved.</p>

<pre><code>&lt;ItemGroup&gt;
  &lt;Compile Include="..\**\*.cs"&gt;
    &lt;Link&gt;%(RecursiveDir)%(Filename)%(Extension)&lt;/Link&gt;
  &lt;/Compile&gt;
&lt;/ItemGroup&gt;
</code></pre>

<p>On saving the project Compile update items would be added for each
file included by the file wildcard.</p>

<pre><code>&lt;ItemGroup&gt;
  &lt;Compile Update="..\Test\Class1.cs"&gt;
    &lt;Link&gt;Class1.cs&lt;/Link&gt;
  &lt;/Compile&gt;
&lt;/ItemGroup&gt;
</code></pre>

<p>This problem is similar to the previous problem where the evaluated Link value was being
compared with the unevaluated value, which did not match, resulting
MSBuild update items being added to the project when it was saved. Now if the property
value contains a % character a comparison is made against the evaluated value when checking if
the project item has changed.</p>

<p><strong>TargetFramework changed on saving project</strong></p>

<p>Adding a file to an SDK style project that targeted Tizen 4.0 would
result in the TargetFramework changing from <strong>tizen40</strong> to <strong>tizen4.0</strong>.
Now the original framework identifier name is not modified and if
the version of the framework changes then the version will be
dotted or contain only numbers based on the format that was originally used
in the project file.</p>

<p><strong>ASP.NET Core file templates modifying project file</strong></p>

<p>Adding a new .cshtml file from a file template to an ASP.NET Core
project would modify the project file when it should not have been
modified. The problem was the files were added as None items whilst
.cshtml are Content items. The project file would contain the
following after adding a new cshtml file from a template:</p>

<pre><code>&lt;ItemGroup&gt;
  &lt;Content Remove="Views\Index.cshtml" /&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;None Include="Views\Index.cshtml" /&gt;
&lt;/ItemGroup&gt;
</code></pre>

<p>Another problem was that the Razor Page with view model file
template specifies a DependentUpon property so this was added to the
project file. This would result in the .cshtml and .cs files being nested whilst
the other .cshtml and .cs files created with the initial ASP.NET
Core project template were not nested. The project file would include
the following:</p>

<pre><code>&lt;ItemGroup&gt;
  &lt;Compile Update="Views\Index.cshtml.cs"&gt;
    &lt;DependentUpon&gt;Index.cshtml&lt;/DependentUpon&gt;
  &lt;/Compile&gt;
&lt;/ItemGroup&gt;
</code></pre>

<p>The .NET Core SDK does not indicate that .cshtml and .cs
files are dependent on each other so they are not currently nested
in the Solution window. New .cshtml files created from these updated
file templates will now not be nested in Solution window.</p>

<p><strong>XAML files not nested after editing project file in editor</strong></p>

<p>Adding a new content page with xaml to a .NET Standard project,
then excluding the files from the project, but not deleting it,
then editing the project file and commenting out the MSBuild remove
items, would then result in the xaml files not being nested in the
Solution window. The problem was that the MSBuild update item
for the .xaml.cs file, defined by the Xamarin.Forms default msbuild
items, was being removed from the MSBuild project in
memory. This MSBuild update item had the DependsOn property defined
so this information was lost on reloading the project. Now a check
is to made to ensure only update items that exist in the original
project file are removed.</p>

<p><strong>MSBuild item added for XAML file copied to a .NET Standard project</strong></p>

<p>When copying a .xaml file from a Portable Class Library project to a .NET Standard project
an MSBuild include item for the file would be added if the .xaml file did
not have the default metadata properties defined by Xamarin.Forms.
Now .NET Core projects opt-in to supporting items not being excluded if they
are missing MSBuild item metadata
which prevents an MSBuild include item added for the .xaml file.</p>

<p><strong>Duplicate XAML file build error when copying file to a .NET Standard project</strong></p>

<p>Copying a .xaml file from a Portable Class Library project to a .NET Standard project
would result an MSBuild item for the .xaml file to the project causing it to not
build due to a duplicate .xaml file.</p>

<p>Now when a xaml file is copied into a .NET Standard project, and it is missing
properties that are included in by an update wildcard,
an MSBuild item will not be added to the project.</p>

<p><strong>MSBuild remove item not added for .xaml.cs file</strong></p>

<p>With a .NET Core project, containing a single .xaml file and a
dependent .xaml.cs file, removing but not deleting the .xaml file
from the Solution window would not add an MSBuild remove item for
the .xaml.cs file even though it was removed from the Solution window.</p>

<p>The problem was that the Xamarin.Forms NuGet package includes a
Compile update item and only this was being considered when saving
the project file. The default file wildcard, that includes all .cs files,
provided by the .NET Core SDK was not considered. Only the last MSBuild item
associated with the .xaml.cs file was being considered. If there was another .cs
file in the project then the MSBuild remove item was added correctly. To avoid this
all MSBuild items associated with a project item are now considered.</p>

<p><strong>MSBuild remove item not removed on adding XAML file to project</strong></p>

<p>When an .xaml file was removed but not deleted, and Xamarin.Forms 2.5
used, which has default MSBuild items defined, on adding the .xaml
file back again to the project the EmbeddedResource
remove item was not removed from the project.</p>

<p>The problem was that the .xaml file was being added as a None item
since by default there is no build action specified for .xaml files.</p>

<p>Another problem was that the MSBuild remove
items, defined by Xamarin.Forms that remove all .xaml files from the default None
included by the .NET Core SDK, were being ignored since the file wildcards were not
found.</p>

<p>Also an msbuild item is no longer added for an existing xaml file when it is
added to the project. The Xamarin.Forms default msbuild items
for .xaml files have extra metadata which were not being added to
the file when it was added to the project from the file system.</p>

<p><strong>Update item added on renaming xaml.cs file</strong></p>

<p>When the .xaml and .xaml.cs file were renamed at the same time an
MSBuild update item was added for the .xaml.cs file even though the Xamarin
Forms NuGet package has a default MSBuild item that was the same as
the generated MSBuild update item.</p>

<p><strong>Argument null exception logged on opening .NET Core project</strong></p>

<p>Opening a .NET Core project would sometimes log an unhandled
ArgumentNullException. A file created event was sometimes raised before
the project had finished loading and could result in
a null set of items being used when checking if the
new file should be added to the project. This is now handled. The files being
created on project load are typically in the obj folder and would be
ignored by the default file wildcards.</p>

<pre><code>An unhandled exception has occured. Terminating Visual Studio? False
System.ArgumentNullException: Value cannot be null.
Parameter name: source
  at System.Linq.Enumerable.Where[TSource]
  in corefx/src/System.Linq/src/System/Linq/Where.cs:42
  at MonoDevelop.Projects.Project.OnFileCreatedExternally
in src/core/MonoDevelop.Core/MonoDevelop.Projects/Project.cs:4041
</code></pre>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/2">&larr; Older</a>
    
    <a href="/blog/archives/">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Matt Ward -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
