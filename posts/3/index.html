
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Matt Ward</title>
  <meta name="author" content="Matt Ward">

  
  <meta name="description" content="Changes VSTest Console Runner now included with Visual Studio for Mac Allows xUnit tests to be supported for non .NET Core projects Renamed ASP.NET &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lastexitcode.com/posts/3">
  <link href="/favicon.ico" rel="icon" type="image/x-icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Matt Ward" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-34592677-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Matt Ward</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
  
  
  
  
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="lastexitcode.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/projects/">Projects</a></li>
  <li><a href="/blog/archives/">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/12/18/NetCoreSupportInVisualStudioMac7-3/">.NET Core Support in Visual Studio for Mac 7.3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-12-18T12:00:00+00:00" pubdate data-updated="true">Dec 18<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li> <a href="https://github.com/Microsoft/vstest">VSTest</a> Console Runner now included with Visual Studio for Mac

<ul>
<li>Allows <a href="https://xunit.github.io">xUnit</a> tests to be supported for non .NET Core projects</li>
</ul>
</li>
<li> Renamed ASP.NET Core Project Templates</li>
<li> New ASP.NET Core F# Project Templates Added</li>
<li> Support Backslash in Project Template Primary Output Path</li>
<li> Support <a href="https://github.com/NuGet/Home/wiki/%5BSpec%5D-NuGet-settings-in-MSBuild">NuGet Restore MSBuild Properties</a>

<ul>
<li>RestoreAdditionalProjectFallbackFolders</li>
<li>RestoreAdditionalProjectSources</li>
<li>RestoreFallbackFolders</li>
<li>RestorePackagesPath</li>
<li>RestoreSources</li>
</ul>
</li>
<li> Fixed transitive project references not supported</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.3</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes#release-date-december-4-2017---visual-studio-2017-version-73-730797">release notes</a></p>

<h2>VSTest Console Runner</h2>

<p>Previous versions of Visual Studio for Mac would use <strong>dotnet vstest</strong>,
included with the .NET Core SDK,
to run unit tests for .NET Core projects. Now Visual Studio for Mac includes
the <a href="https://github.com/Microsoft/vstest">VSTest</a> Console runner and uses that instead of using the .NET Core SDK.</p>

<p>The standalone VSTest Console runner allows other project types, not just .NET Core projects, to
be supported. Visual Studio for Mac can now run <a href="https://xunit.github.io">xUnit</a> tests
for .NET Framework projects. Previously only NUnit was supported.</p>

<p>Let us take a look at using xUnit in a .NET Framework project.</p>

<p>First create a .NET Framework Library project by opening the New Project dialog and selecting
Library from the Other &ndash; .NET &ndash; General category.</p>

<p>Install the following NuGet packages into the project.</p>

<ul>
<li>xunit</li>
<li>xunit.runner.visualstudio</li>
</ul>


<p>Edit MyClass.cs and add some xUnit tests, as shown below:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>using Xunit;
</span><span class='line'>
</span><span class='line'>namespace xUnitTests
</span><span class='line'>{
</span><span class='line'>  public class MyClass
</span><span class='line'>  {
</span><span class='line'>      [Fact]
</span><span class='line'>      public void PassingTest()
</span><span class='line'>      {
</span><span class='line'>          Assert.True(true);
</span><span class='line'>      }
</span><span class='line'>
</span><span class='line'>      [Fact]
</span><span class='line'>      public void FailingTest()
</span><span class='line'>      {
</span><span class='line'>          Assert.False(true);
</span><span class='line'>      }
</span><span class='line'>  }
</span><span class='line'>}
</span></code></pre></td></tr></table></div></figure>


<p>Building the project should then show the xUnit tests in the Unit Tests window.</p>

<p><img src="/images/blog/NetCoreSupportInVisualStudioMac7-3/xUnitTestsInUnitTestsWindow.png" title="xUnit tests in Unit Tests window" alt="xUnit tests in Unit Tests window"></p>

<p>Note that, due to a bug in Visual Studio for Mac, the tests may not appear in the
Unit Tests window if the
xunit.runner.visualstudio was not available in the local machine&rsquo;s NuGet
package cache when it was added to the project. Closing and re-opening the
solution should allow the tests to be discovered.</p>

<p>The tests can then be run or debugged in the usual way.</p>

<p>Currently MSTest is not yet supported in .NET Framework projects. The tests are discovered
but they fail to run with an access denied error message:</p>

<pre><code>An exception occurred while invoking executor 'executor://mstestadapter/v2': 
Access to the path "/TestResults" is denied.
</code></pre>

<h2>Renamed ASP.NET Core Project Templates</h2>

<p>The ASP.NET Core template names displayed in the New Project dialog
have been changed to be more consistent with Visual Studio on Windows.</p>

<ul>
<li>&lsquo;ASP.NET Core Web App (Razor Pages)&rsquo; renamed to &lsquo;ASP.NET Core Web App&rsquo;</li>
<li>&lsquo;ASP.NET Core Web App&rsquo; renamed to &lsquo;ASP.NET Core Web App (MVC)&rsquo;</li>
</ul>


<p>Visual Studio uses (Model-View-Controller) but the shorter
MVC is used by Visual Studio for Mac.</p>

<h2>New ASP.NET Core F# Project Templates Added</h2>

<p>The following ASP.NET Core F# project templates are now available from the
New Project dialog.</p>

<ul>
<li>ASP.NET Core Empty

<ul>
<li>.NET Core 1.x and 2.0</li>
</ul>
</li>
<li>ASP.NET Core Web API

<ul>
<li>.NET Core 2.0 only</li>
</ul>
</li>
</ul>


<h2>Support Backslash in Project Template Primary Output Path</h2>

<p>The template.json file used by the new templating engine uses a
primaryOutputs property for projects and files. If the paths used
contained backslashes then the project was not added to the
solution.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>"primaryOutputs": [
</span><span class='line'>  { "path": "Library1\\Library1.csproj" },
</span><span class='line'>  { "path": "Library2\\Library2.csproj" }
</span><span class='line'>]</span></code></pre></td></tr></table></div></figure>


<p>Now the paths have the backslashes replaced with forward slashes if
the current platform does not support backslash as a path
separator.</p>

<h2>Support RestoreAdditionalProjectFallbackFolders MSBuild Property</h2>

<p>The RestoreAdditionalProjectFallbackFolders MSBuild property is
read and appended to the list of fallback folders stored in the
project.assets.json file. The .NET Core 2.0 SDK will set this
MSBuild property to point to the NuGet package fallback folder
that is installed with the SDK. This will be used
to resolve NuGet packages first before downloading them to the
~/.nuget/packages folder.</p>

<h2>Support RestoreAdditionalProjectSources MSBuild Property</h2>

<p>The RestoreAdditionalProjectSources MSBuild property can be used
to add additional package sources to the existing list of sources
used to resolve packages.</p>

<h2>Support RestoreFallbackFolders MSBuild Property</h2>

<p>The RestoreFallbackFolders MSBuild property can be used by project that uses
PackageReferences to define a set of package fallback folders that
will override any specified in the NuGet.Config file. It can also
be used to clear any pre-defined fallback folders by specifying
&lsquo;clear&rsquo; as its value. Note that this value does not affect any
folders defined by RestoreAdditionalProjectFallbackFolders which
will be appended even if RestoreFallbackFolders is set to &lsquo;clear&rsquo;.</p>

<h2>Support RestorePackagesPath MSBuild Property</h2>

<p>The RestorePackagesPath MSBuild property can be used to override the global packages
folder location when a project uses a PackageReference.</p>

<h2>Support RestoreSources MSBuild property</h2>

<p>The RestoreSources MSBuild property can be used to override
the sources defined by any NuGet.Config file. Any sources defined in the
RestoreAdditionalProjectSources MSBuild property will still be appended to the
list of sources if RestoreSources is defined.</p>

<h2>Bug Fixes</h2>

<p><strong>Fixed Transitive Project References not supported</strong></p>

<p>With three .NET Core projects, LibC referencing LibB referencing LibA,
the types defined by LibA were not available to LibC unless it was
directly referencing LibA. In Visual Studio for Mac 7.3 the types
defined by LibA are available to LibC without LibC directly
referencing LibA.</p>

<p><strong>Portable Class Library projects can now be referenced by .NET Core projects</strong></p>

<p>Portable Class Library (PCL) projects could not be referenced by .NET Core
projects or .NET Standard projects. The Edit References dialog would show
&ldquo;Incompatible target framework&rdquo; for the PCL project when trying to add the
reference.</p>

<p>Visual Studio for Mac now has the same behaviour as Visual Studio on Windows where
a .NET Standard project can reference any PCL project.</p>

<p><strong>Fixed MSBuild Update item not removed from project</strong></p>

<p>If a file was deleted from a project, or removed without deleting,
and the file was the last file for a particular wildcard include, the
Update item for the file was not being removed from the project.</p>

<p><strong>Fixed MSBuild Remove item not added when Update item exists</strong></p>

<p>With a project that contained a single .cs file, and that file had
an Update item defined, when the file was removed from the project,
without deleting it, a Remove item was not being added to the project for the file.</p>

<p><strong>Fixed Remove item not being added when file excluded from project</strong></p>

<p>When the last file was removed from the project, but not deleted, an
MSBuild Remove item was not added to the project for the file.</p>

<ol>
<li>Create a .NET Standard 2.0 project.</li>
<li>Right click Class1.cs and select Remove.</li>
<li>Select Remove from Project in the dialog that opens.</li>
<li>Close and re-open solution.</li>
</ol>


<p>The Class1.cs file was still shown in the Solution window when it should have been
removed. The project file did not have a Compile remove item for Class1.cs when it should
have been added:</p>

<pre><code>&lt;Compile Remove="Class1.cs" /&gt;
</code></pre>

<p><strong>Deleting a XAML file left an MSBuild Remove item in project file</strong></p>

<p>When a .xaml file in a project was deleted the associated
Remove MSBuild item, if it was present, was not being removed from the
project file.</p>

<ol>
<li> Create a new .NET Standard 2.0 project.</li>
<li> Add Xamarin.Forms 2.3 NuGet package.</li>
<li> Add a new Content Page with Xaml file using the New File dialog.</li>
<li> In the Solution window select the .xaml file and delete it.</li>
</ol>


<p>All MSBuild items associated with the .xaml file should have been
removed from the project file but instead a None item would remain.</p>

<pre><code>&lt;None Remove="MyPage.xaml" /&gt;
</code></pre>

<p><strong>Fix MSBuild remove item not added when adding a XAML file</strong></p>

<p>Adding a new .xaml file to a project was not adding a None Remove
item for the .xaml file to remove it from the default wildcard include for all
files.</p>

<pre><code>&lt;None Remove="MyNewPage.xaml" /&gt;
</code></pre>

<p>On reloading the solution the Solution window would show two .xaml
files &ndash; one EmbeddedResource item and one None item.</p>

<p><strong>Fixed MSBuild condition evaluation when using Czech locale</strong></p>

<p>With the primary operating system language set to Czech, creating a new .NET
Core project would result in the project having a target framework of net461.</p>

<p>The problem was that Single.TryParse was returing true for an empty string
when the machine&rsquo;s culture was &lsquo;cs-CZ&rsquo;. This was causing the MSBuild condition
evaluation to be treated as a boolean comparison incorrectly in some cases.
The condition below would return false even though the property was
not defined and both sides of the condition were empty strings:</p>

<pre><code>&lt;PropertyGroup Condition="'$(TargetFrameworkIdentifier)' == ''"&gt;
</code></pre>

<p>This was causing the TargetFrameworkIdentifier to not be set for
.NET Core projects so the default of .NETFramework was being used.</p>

<p><strong>Re-evaluate AppliesTo condition on capability change</strong></p>

<p>Fixed the AppliesTo attribute not attaching a project extension to
a project after a NuGet package restore enabled a project capability.
The AppliesTo attribute allows a project extension to be associated
to a project based on its capabilities.</p>

<p>If the project extension uses an AppliesTo attribute which is
initially false and then a new project capability is added, and the
project is re-evaluated, the AppliesTo attribute is now
re-evaluated. This will then cause the project extension to be
attached to the project. If the project extension was attached to the
project and the project capability is removed then the project
extension will now be removed when the project is re-evaluated.</p>

<p><strong>Fixed being unable to run a new Azure Functions project</strong></p>

<p>Creating a new Azure Functions project would result in
being unable to run the project until the solution was closed
and re-opened again. After the NuGet packages are restored the
project can be run but this information was not updated in Visual Studio
for Mac.</p>

<p>Now after a NuGet package restore, when re-evaluating the project,
the solution startup item is updated if there is no startup item
already defined.</p>

<p>When the project capability is removed, due to a NuGet package
being uninstalled, and the
project can no longer be run the startup item will be updated if
it was previously set to be this project.</p>

<p><strong>Fix generated NuGet files being imported twice</strong></p>

<p>The ProjectName.nuget.g.targets and ProjectName.nuget.g.props,
that are generated for .NET Core projects in the base intermediate
directory, were being imported twice.
Once by Microsoft.Common.props, that is provided with Mono, and once
again by Visual Studio for Mac.</p>

<p>Importing these files twice was causing a duplicate file to be added to
the project information held in memory by Visual Studio for Mac
when Xamarin.Forms 2.4 was used and no .NET Core SDK was installed.
This would result in the content page xaml and associated C# file not
being nested in the solution window.</p>

<p><strong>Fixed items added to project when a new content page with XAML was created</strong></p>

<p>Adding a new Xamarin.Forms content page with XAML would add an
update item for the .xaml.cs file, a remove item for the xaml file,
and an include item for the xaml file.</p>

<p>An example is Xamarin.Forms 2.4 which defines wildcard includes:</p>

<pre><code>&lt;None Remove="**\*.xaml" /&gt;
&lt;EmbeddedResource Include="**\*.xaml" SubType="Designer" Generator="MSBuild:UpdateDesignTimeXaml" /&gt;
</code></pre>

<p>Which would cause a new .xaml file added to the project and saved
in the project file as well as a remove for the None item even though
the .xaml file was already removed from the None items.</p>

<pre><code>&lt;None Remove="MyView.xaml" /&gt;

&lt;EmbeddedResource Include="MyView.xaml"&gt;
  &lt;Generator&gt;MSBuild:UpdateDesignTimeXaml"&lt;/Generator&gt;
&lt;/EmbeddedResource&gt;
</code></pre>

<p><strong>Fix DependentUpon property being saved in project</strong></p>

<p>Xamarin.Forms 2.4 defines an update item similar to:</p>

<pre><code>&lt;Compile Update="**\*.xaml.cs" DependentUpon="%(Filename)" /&gt;
</code></pre>

<p>When a project was saved a Compile item was added to the main project
with the filename stored in the DependentUpon element. Now
the evaluated DependentUpon value is treated as being the default
value so it is not added to the project file.</p>

<p><strong>Fix xaml.cs files not being nested</strong></p>

<p>Xamarin.Forms 2.4 defines an update item similar to:</p>

<pre><code>&lt;Compile Update="**\*.xaml.cs" DependentUpon="%(Filename)" /&gt;
</code></pre>

<p>The DependentUpon property was being evaluated as &lsquo;*.xaml.cs&rsquo;.
This was causing .xaml.cs files to not be nested in the Solution window.</p>

<p><strong>Fixed build error when Xamarin.Forms 2.4 used in a .NET Standard project</strong></p>

<p>If a Xamarin.Forms .NET Standard project had a
.xaml file and a .xaml.cs file then the xaml.g.cs file would not be
generated when the project file contained no files. The
default items defined by the Xamarin.Forms NuGet package were not
being imported. This then caused a build error about the
InitializeComponent method not being defined.</p>

<p>Xamarin.Forms 2.4.0 uses default
item imports which were not being included since they are conditionally
imported and the MSBuildSDKsPath was not defined:</p>

<pre><code>&lt;Import Project="$(MSBuildThisFileDirectory)Xamarin.Forms.DefaultItems.props" Condition="'$(MSBuildSDKsPath)'!=''" /&gt;
</code></pre>

<p>MSBuild on the command line defines the MSBuildSDKsPath globally in
its MSBuild.dll.config file. The MSBuild engine host, used when
building a project in Visual Studio for Mac, now also defines the
MSBuildSDKsPath property.</p>

<p><strong>Fixed remove item added when removing a linked file</strong></p>

<p>Deleting a file link in a .NET Core project would add a remove item
for the file instead of removing the link from the project.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/12/10/NuGetSupportInVisualStudioMac7-3/">NuGet Support in Visual Studio for Mac 7.3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-12-10T11:00:00+00:00" pubdate data-updated="true">Dec 10<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li> Support installing System.ValueTuple NuGet Package from Quick Fixes</li>
<li> NuGetizer 3000 &ndash; Update NuGet.Build.Packaging to version 0.2</li>
<li> Support NuGet Restore MSBuild Properties

<ul>
<li>RestoreAdditionalProjectFallbackFolders</li>
<li>RestoreAdditionalProjectSources</li>
<li>RestoreFallbackFolders</li>
<li>RestorePackagesPath</li>
<li>RestoreSources</li>
</ul>
</li>
<li> Fixed transitive dependencies not available when using project.json</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.3</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes#release-date-december-4-2017---visual-studio-2017-version-73-730797">release notes</a>.</p>

<h2>Quick Fix &ndash; Install System.ValueTuple NuGet Package</h2>

<p><a href="https://blogs.msdn.microsoft.com/dotnet/2016/08/24/whats-new-in-csharp-7-0/">C# 7.0 introduced tuple types</a>
that may require the System.ValueTuple NuGet package
to be added to the project. Visual Studio for Mac
now offers to install the System.ValueTuple NuGet package if the project requires this NuGet package.</p>

<p>Creating a .NET Framework 4.6 project with the following code:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>public (string, int) GetValues(string id)
</span><span class='line'>{
</span><span class='line'>  return ("Name", 25);
</span><span class='line'>}</span></code></pre></td></tr></table></div></figure>


<p>You will see error markers in the text editor. If you hover over
one of these error markers you will see a
<strong>Predefined type &lsquo;System.ValueTuple`2&rsquo; is not defined or imported</strong> message.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-3/ValueTupleTextEditorErrorTooltip.png" title="ValueTuple type not defined text editor error tooltip" alt="ValueTuple type not defined text editor error tooltip"></p>

<p>If you right click the error marker there is now a new
<strong>Install Package &lsquo;System.ValueTuple&rsquo;</strong> Quick Fix action available.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-3/TextEditorInstallSystemValueTuplePackageQuickFix.png" title="Text editor Install System.ValueTuple Package quick fix menu item" alt="Text editor Install System.ValueTuple Package quick fix menu item"></p>

<p>From this menu you can install the latest System.ValueTuple NuGet package
or open the Add Packages dialog to search for a specific version of the System.ValueTuple NuGet
package.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-3/TextEditorInstallLatestSystemValueTupleQuickFix.png" title="Text editor install latest System.ValueTuple package quick fix menu item" alt="Text editor install latest System.ValueTuple package quick fix menu item"></p>

<p>Note that if the project is targeting .NET Framework 4.7 or .NET Standard 2.0 then the
System.ValueTuple NuGet package is not required.</p>

<p>Also note that the official nuget.org package source needs to be available
for this feature to work.</p>

<h2>NuGetizer 3000 &ndash; Updated NuGet.Build.Packaging to version 0.2</h2>

<p>The version of the NuGet.Build.Packaging NuGet package used by default for NuGetizer 3000 support
has been updated from 0.1.276 to 0.2.0. This fixes a
potential build error when building with Mono 5.6.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Using "ReportAssetsLogMessages" task from assembly "/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/../tools/net46/Microsoft.NET.Build.Tasks.dll".
</span><span class='line'>Task "ReportAssetsLogMessages"
</span><span class='line'>/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: The "ReportAssetsLogMessages" task failed unexpectedly. [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
</span><span class='line'>/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: System.TypeLoadException: Could not resolve type with token 0100005b (from typeref, class/assembly NuGet.ProjectModel.IAssetsLogMessage, NuGet.ProjectModel, Version=4.3.0.5, Culture=neutral, PublicKeyToken=31bf3856ad364e35) [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
</span><span class='line'>/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: at Microsoft.NET.Build.Tasks.TaskBase.Execute () [0x00000] in &lt;01420900fd004c128de2d2ee31bad624&gt;:0 [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
</span><span class='line'>/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute () [0x00023] in &lt;765502eb2f884ce79731edeb4b0517fb&gt;:0 [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
</span><span class='line'>/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: at Microsoft.Build.BackEnd.TaskBuilder+d__26.MoveNext () [0x0022d] in &lt;765502eb2f884ce79731edeb4b0517fb&gt;:0 [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]</span></code></pre></td></tr></table></div></figure>


<p>The ReadLegacyDependencies target from NuGet.Build.Packaging.Tasks is called when PackOnBuild
is set to true.</p>

<p>The NuGet.Build.Packaging.Tasks assembly was loading an embedded NuGet.ProjectModel
assembly that conflicts with the version that is used by Microsoft.NET.Build.Tasks.</p>

<h2>Support RestoreAdditionalProjectFallbackFolders MSBuild Property</h2>

<p>The RestoreAdditionalProjectFallbackFolders MSBuild property is
read and appended to the list of fallback folders stored in the
project.assets.json file. The .NET Core 2.0 SDK will set this
MSBuild property to point to the NuGet package fallback folder
that is installed with the SDK. This will be used
to resolve NuGet packages first before downloading them to the
~/.nuget/packages folder.</p>

<h2>Support RestoreAdditionalProjectSources MSBuild Property</h2>

<p>The RestoreAdditionalProjectSources MSBuild property can be used
to add additional package sources to the existing list of sources
used to resolve packages.</p>

<h2>Support RestoreFallbackFolders MSBuild Property</h2>

<p>The RestoreFallbackFolders MSBuild property can be used by project that uses
PackageReferences to define a set of package fallback folders that
will override any specified in the NuGet.Config file. It can also
be used to clear any pre-defined fallback folders by specifying
&lsquo;clear&rsquo; as its value. Note that this value does not affect any
folders defined by RestoreAdditionalProjectFallbackFolders which
will be appended even if RestoreFallbackFolders is set to &lsquo;clear&rsquo;.</p>

<h2>Support RestorePackagesPath MSBuild Property</h2>

<p>The RestorePackagesPath MSBuild property can be used to override the global packages
folder location when a project uses a PackageReference.</p>

<h2>Support RestoreSources MSBuild property</h2>

<p>The RestoreSources MSBuild property can be used to override
the sources defined by any NuGet.Config file. Any sources defined in the
RestoreAdditionalProjectSources MSBuild property will still be appended to the
list of sources if RestoreSources is defined.</p>

<h2>Bug Fixes</h2>

<p><strong>Transitive dependencies not available when using project.json</strong></p>

<p>With two projects A and B that both use project.json files, project B
referencing project A, the NuGet package dependencies used by project
A were not available to project B transitively. This was because the
project reference information was not being used
when a restore occurred. This caused the assemblies from the transitively
referenced NuGet packages to not be added to the
project.lock.json file for Project B.</p>

<p><strong>Unable to debug a new Azure Functions project without re-opening project</strong></p>

<p>After creating a new Azure Functions project it was possible to build the
project but not to debug it or run it. On closing and re-opening the solution
it would be possible to debug and run the Azure Functions project.</p>

<p>When Visual Studio for Mac created a new Azure Functions project
it initially determined that it could not run or debug the project.
After the Azure Functions project has its PackageReferences restored
it gains an AzureFunctions project capability. This capability is used to
determine if the project can be run. This change in the capability
was not handled by Visual Studio for Mac so it did not allow the
project to be run until the project was closed and re-opened.</p>

<p>Now, after the NuGet package restore is finished, the project is
re-evaluated and a check is made to see if the project can now be run.</p>

<p><strong>Fix generated NuGet files being imported twice</strong></p>

<p>The generated ProjectName.nuget.g.targets and ProjectName.nuget.g.props
that are created for .NET Core projects in the base intermediate
directory were being imported twice when evaluating the project.
Once by Microsoft.Common.props, provided with Mono, and once
by Visual Studio for Mac.</p>

<p>This duplicate import was resulting in a duplicate file being added
to the project held in memory by Visual Studio for Mac when the
Xamarin.Forms 2.4 NuGet package was used in a .NET Standard
project and no .NET Core SDK is installed. This would result in the
content page xaml and associated C# file not being nested in the
solution window.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/11/12/TemplateCreatorForVisualStudioMac/">Template Creator for Visual Studio for Mac</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-11-12T14:30:00+00:00" pubdate data-updated="true">Nov 12<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>The <a href="https://github.com/mrward/monodevelop-template-creator-addin">Template Creator extension</a> provides a way to create a project template from an existing project
or solution open in Visual Studio for Mac and have the project template available in the New
Project dialog straight away.</p>

<p>The Template Creator uses the <a href="https://github.com/dotnet/templating">.NET Core templating engine</a>
to create the projects from the project templates.</p>

<p>Let us take a look in more detail at what the Template Creator extension provides in Visual Studio for Mac.</p>

<h2>Features</h2>

<ul>
<li> Create a project template from an existing solution or project</li>
<li> Create custom top level project template categories</li>
</ul>


<h2>Supports</h2>

<ul>
<li>Visual Studio Mac 7.0 or later.</li>
</ul>


<h2>Creating a new Project Template</h2>

<p>To create a new project template for a project opened in Visual Studio for Mac,
right click the project and select Create Template.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/ProjectCreateTemplateMenu.png" title="Project - Create Template context menu" alt="Project - Create Template context menu"></p>

<p>A Template Information dialog is then opened.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/TemplateInformationDialog.png" title="Template Information dialog" alt="Template Information dialog"></p>

<p>The information in the dialog is used to populate the generated template.json file. Further
details on what the template.json file holds is available in the <a href="https://github.com/dotnet/templating/wiki/Reference-for-template.json">reference for template.json</a>.</p>

<ul>
<li>Author

<ul>
<li>Author of the project template.</li>
</ul>
</li>
<li>Display Name

<ul>
<li>This is the template name displayed in the New Project dialog.</li>
</ul>
</li>
<li>Description

<ul>
<li>This is the description displayed in the New Project dialog.</li>
</ul>
</li>
<li>Category

<ul>
<li>This is the category in the New Project dialog used by the template.</li>
</ul>
</li>
<li>Short Name

<ul>
<li>This is the short name for the template that can be used from the .NET Core command line.</li>
</ul>
</li>
<li>Default Project Name

<ul>
<li>This is the default project name that will be used with the .NET Core command line.</li>
</ul>
</li>
<li>Identity

<ul>
<li>This is the unique id for the template. This should be unique across all custom
project templates.</li>
</ul>
</li>
<li>Group Identity

<ul>
<li>This is typically a substring of the template&rsquo;s Identity.</li>
</ul>
</li>
</ul>


<p>By default the project template will use the Other &ndash; .NET &ndash; General category in the
New Project dialog. To change the category click the browse button next to the category text
box to open the Template Categories dialog.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/TemplateCategoriesDialog.png" title="Template Categories dialog" alt="Template Categories dialog"></p>

<p>Select the required category and click OK. The selected category will then be updated
in the Template Information dialog.</p>

<p>Click OK to generate the template.json file. The template.json file will be opened
in the text editor. It will also be displayed in the Solution window in the
.template.config folder.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/ProjectTemplateJsonFile.png" title="template.json file created for project" alt="template.json file created for project"></p>

<p>The project template is now available in the New Project dialog.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/CustomProjectTemplateInNewProjectDialog.png" title="Custom project template in New Project dialog" alt="Custom template in New Project dialog"></p>

<h2>Updating a Project Template</h2>

<p>After the project template is created you can modify the original project and its
template.json file as required.</p>

<p>Changes made to the project are available in the New Project dialog immediately.</p>

<p>Changes made to the template.json file are available immediately in the same
instance of Visual Studio for Mac where the template.json file is being edited.</p>

<h2>Multiple Projects in a Template</h2>

<p>A project template may create more than one project. To create a project template
for all projects in the solution right click the solution and select Create Template.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/SolutionCreateTemplateMenu.png" title="Solution - Create Template context menu" alt="Solution - Create Template context menu"></p>

<p>A template.json file will be created in a .template.config directory inside the solution&rsquo;s
directory.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/TwoProjectsTemplateJsonFile.png" title="template.json file created for soluton" alt="template.json file created for solution"></p>

<p>Note that in order for the new projects created to use the name specified in the New Project
dialog they should all have a common start to their name. The template.json file&rsquo;s <code>sourceName</code>
will be the part that is replaced with the name of the project specified in the New Project dialog.</p>

<h2>Configuring Registered Project Templates</h2>

<p>The .NET Core templating engine supports project templates in NuGet packages or project templates
that unpackaged in a directory. The Template Creator extension does
not package the project templates into a NuGet package and instead stores a set of directories that
are scanned by the .NET Core templating engine for templates. The set of directories that are
registered can be viewed and updated in the Preferences dialog from the Templates &ndash; Custom Folders section.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/PreferencesCustomFolders.png" title="Preferences dialog - Templates - Custom Folders" alt="Preferences dialog - Templates - Custom Folders"></p>

<p>The templating engine will scan the configured directories and look for all the template.json files
which define the project templates. The project templates found are then made available to the
Visual Studio for Mac&rsquo;s New Project dialog by the Template Creator extension.</p>

<p>When the template.json file is created using the information in the Template Information dialog
the Template Creator extenxion also registers the
project&rsquo;s directory so it will be scanned by the templating engine.</p>

<p>To remove a project
template from the New Project dialog you can either delete the template.json file or
remove the folder from the Custom Folders defined in the Preferences dialog.</p>

<p>If you have an existing set of project templates that use template.json files and are not
in a NuGet package then you can register a single parent directory in the Preferences dialog.</p>

<h2>Custom Categories</h2>

<p>Custom top level categories can be defined for your project templates by adding them in
Preferences &ndash; Templates &ndash; Custom Categories.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/PreferencesCustomCategories.png" title="Preferences dialog - Templates - Custom Categories" alt="Preferences dialog - Templates - Custom Categories"></p>

<p>The Add Top Level Category button will add a new top level category and two child category
levels. The New Project dialog requires three category levels. The ids used should ensure that
the full path to the template&rsquo;s category is unique. For example, with a custom category
<code>custom/net/general</code> there should not be another top level <code>custom</code> category id, but the second
and third level category ids can be re-used in another top level category, such as <code>top/net/general</code>.</p>

<p>The Add Category button will add a single child category to the currently selected category
whilst the Remove button will remove the selected category.</p>

<p>Note that changes to the categories require Visual Studio for Mac to be restarted before they
are visible in the New Project dialog.</p>

<p>Also note that it is not currently possible to extend existing project template categories
using the Template Creator extension.</p>

<h2>Diagnosing Template Problems</h2>

<p>If the template does not appear in the New Project dialog or fails to be created then
you may be able to diagnose the problem by opening the Templating Log window. This is
available from the View &ndash; Pads menu.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/MainMenuViewPadsTemplatingLog.png" title="Main menu - View - Pads - Templating Log" alt="Main menu - View - Templating Log"></p>

<p>This window will show messages returned from the .NET Core templating engine and any errors
reported by the Template Creator extension.</p>

<p><img src="/images/blog/TemplateCreatorForVisualStudioMac/TemplatingLogWindow.png" title="Templating Log window" alt="Templating Log window"></p>

<h2>Installation</h2>

<p>The Template Creator extension is available to download from <a href="https://github.com/mrward/monodevelop-template-creator-addin/releases/download/0.1/MonoDevelop.TemplateCreator_0.1.mpack">GitHub</a>.</p>

<p>To install the extension open the Extensions Manager by selecting Extensions&hellip; from the main menu. Click the Install from file button. Select the .mpack file and then click the Open button.</p>

<p>The extension is also available in the Extensions Manager from the
<a href="http://addins.monodevelop.com/Project/Index/305">Visual Studio Extension Repository (Beta channel)</a>.</p>

<h2>Source Code</h2>

<ul>
<li><a href="https://github.com/mrward/monodevelop-template-creator-addin">Template Creator extension for Visual Studio for Mac and MonoDevelop</a></li>
</ul>


<h2>Further Reading</h2>

<ul>
<li><a href="https://blogs.msdn.microsoft.com/dotnet/2017/04/02/how-to-create-your-own-templates-for-dotnet-new/">How to create your own templates for dotnet new</a></li>
<li><a href="https://github.com/dotnet/templating/wiki/Reference-for-template.json">Reference for template.json</a></li>
<li><a href="https://www.jimbobbennett.io/creating-visual-studio-project-and-solution-templates-part-3-vs-for-mac-extension/">Creating Visual Studio project and solution templates &ndash; Part 3, VS for Mac extension</a></li>
<li><a href="https://github.com/ligershark/sidewafflev2">SideWaffle v2 for Visual Studio</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/11/08/NetCoreSupportInVisualStudioMac7-2/">.NET Core Support in Visual Studio for Mac 7.2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-11-08T15:00:00+00:00" pubdate data-updated="true">Nov 8<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li> Support NuGet package fallback folders</li>
<li> Support AssetTargetFallback</li>
<li> Xamarin.Forms 2.4 support (VS for Mac 7.2.2)</li>
<li> Fixed transitive types from references not being available</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.2</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes#release-date-october-9-2017---visual-studio-2017-for-mac-720636">release notes</a>.</p>

<h2>NuGet package fallback folders support</h2>

<p>The .NET Core SDK 2.0 defines a NuGet package fallback folder <code>/usr/local/share/dotnet/sdk/NuGetFallbackFolder</code> that can be used when looking
for NuGet packages whilst restoring. This fallback folder is now supported by
Visual Studio for Mac 7.2 so that on restoring a .NET Core 2.0 project the NuGet
packages from the fallback folder will be found and do not need to be downloaded from nuget.org into the
local machine NuGet package cache <code>~/.nuget/packages</code>. This should speed up NuGet package restore for .NET Core 2.0 and .NET Standard 2.0 projects the first time it occurs.</p>

<p>As well as the NuGet fallback folders Visual Studio for Mac will now add the following items to the generated project.assets.json
if they are available:</p>

<ul>
<li>configFilePaths</li>
<li>sources</li>
<li>warningProperties</li>
</ul>


<h2>AssetTargetFallback support</h2>

<p>The .NET Core 2.0 SDK uses an AssetTargetFallback MSBuild property
defined in an imported SDK MSBuild files. This is used instead
of the PackageTargetFallback property when determining if a NuGet
package is compatible. Currently the AssetTargetFallback property
is set to net461 by the .NET Core 2.0 SDK which allows .NET Core projects to use NuGet
packages that include assemblies that target the full .NET Framework.
The supported fallback frameworks are now added to the generated
project.assets.json file by Visual Studio for Mac when a .NET Core 2.0 project is restored.</p>

<h2>NuGet package restore now fails if package and asset target fallbacks are defined by a project</h2>

<p>If both AssetTargetFallback and PackageTargetFallback are defined by a project then the
NuGet restore will fail with an error indicating that they cannot
be used together. This mirrors the behaviour of the .NET Core command
line restore.</p>

<h2>Mark implicit PackageReferences as auto referenced</h2>

<p>PackageReference items that have IsImplicitlyDefined set to true
in their metadata now have autoRefererenced set to true in the project.assets.json file.</p>

<h2>Support parsing MSBuild conditions with unquoted properties</h2>

<p>The .NET Core 2.0 SDK uses conditions that pass properties to the
Exists function without using single quotes around the MSBuild property.
This is now supported by Visual Studio for Mac.</p>

<pre><code>&lt;PropertyGroup Condition="Exists($(FileName))"&gt;
</code></pre>

<h2>Xamarin.Forms 2.4 support</h2>

<p>The following sections cover bug fixes made in Visual Studio for Mac 7.2.2
to improve support for <a href="https://developer.xamarin.com/releases/xamarin-forms/xamarin-forms-2.4/2.4.0-stable/">Xamarin.Forms 2.4</a> and later versions. Xamarin.Forms 2.4 includes .NET Standard support as well as defining default MSBuild items for
.NET Core and .NET Standard projects. These default MSBuild items were not
handled by Visual Studio for Mac 7.2.0 and earlier versions. The main symptoms of Visual Studio for Mac not supporting Xamarin.Forms 2.4 were:</p>

<ul>
<li>Duplicate .xaml files in the Solution window.</li>
<li>Nesting of .xaml and .xaml.cs files not working in Solution window.</li>
<li>MSBuild items incorrectly added to SDK style projects.</li>
</ul>


<h3>Generated NuGet files being imported twice</h3>

<p>The generated NuGet files, .nuget.g.targets and .nuget.g.props,
that are created for .NET Core projects were being imported twice.
Once by Microsoft.Common.props, that is provided with Mono, and once
by Visual Studio for Mac.</p>

<p>This double import was causing a duplicate file
to be added to the
project when Xamarin.Forms 2.4
was used in a .NET Standard project and the .NET Core SDK was not
installed. This would result in the .xaml file and associated
.xaml.cs file not being nested in the solution window.</p>

<h3>MSBuild items added when new xaml file added to project</h3>

<p>Adding a new Xamarin.Forms content page with XAML would incorrectly add an
update item to the project for the .xaml.cs file when an SDK style project
was used.</p>

<p>When a new .xaml file was added to an SDK style project a None item as well as an EmbeddedResource item would incorrectly be added to the project file.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;None Remove="MyView.xaml" /&gt;
</span><span class='line'>
</span><span class='line'>&lt;EmbeddedResource Include="MyView.xaml"&gt;
</span><span class='line'>  &lt;Generator&gt;MSBuild:UpdateDesignTimeXaml"&lt;/Generator&gt;
</span><span class='line'>&lt;/EmbeddedResource&gt;</span></code></pre></td></tr></table></div></figure>


<h3>Compile item added with DependentUpon metadata</h3>

<p>Xamarin.Forms 2.4 defines a wildcard update similar to:</p>

<pre><code>&lt;Compile Update="**\*.xaml.cs" DependentUpon="%(Filename)" /&gt;
</code></pre>

<p>When a project was saved in Visual Studio for Mac a Compile item was
incorrectly added to the main project with the evaluated value stored in the
DependentUpon element.</p>

<h3>DependentUpon being evaluated incorrectly</h3>

<p>Metadata defined for wildcard MSBuild items were being evaluated using
the wildcard item instead of the expanded item. This
was causing .xaml.cs files to not be nested in the Solution window
for Xamarin.Forms 2.4.</p>

<p>Xamarin.Forms 2.4 defines an update item similar to:</p>

<pre><code>&lt;Compile Update="**\*.xaml.cs" DependentUpon="%(Filename)" /&gt;
</code></pre>

<p>The DependentUpon property was evaluated using the wildcard item
which resulted in the DependentUpon property being
evaluated as &lsquo;*.xaml.cs&rsquo; instead of the filename of the item that was
updated by the wildcard.</p>

<h3>Define MSBuildSDKsPath for MSBuild engine host</h3>

<p>MSBuild when run on the command line defines the MSBuildSDKsPath in
its MSBuild.dll.config file. The MSBuild engine host that is used
when building with Visual Studio for Mac now also defines the MSBuildSDKsPath property. Previously this was not being defined.</p>

<p>This fixes a build error when using Xamarin.Forms 2.4.0 in an SDK style
project that targets .NET Standard. Xamarin.Forms 2.4.0 uses default
item imports which were not being included since they are conditionally
imported based on the MSBuildSDKsPath property value:</p>

<pre><code>&lt;Import Project="$(MSBuildThisFileDirectory)Xamarin.Forms.DefaultItems.props" 
    Condition="'$(MSBuildSDKsPath)'!=''" /&gt;
</code></pre>

<p>If the SDK style project had a .xaml file and a .xaml.cs file then
the .xaml.g.cs file was not being generated when the project had no files
explicitly defined in the project file. This
then caused a build error about the InitializeComponent method not
being defined.</p>

<h2>Bug Fixes</h2>

<p><strong>Fixed transitive assembly references not available until restart</strong></p>

<p>Given a solution that contains three .NET Standard projects: LibC
references LibB which references LibA. If the Newtonsoft.Json NuGet
package was installed into LibA the types from this NuGet package
were not available in LibB or LibC until the solution was closed and
re-opened again. Closing and re-opening the solution refreshes the
reference information used by the type system. Now when a NuGet
package is installed into a .NET Core project the projects that
reference this project have their reference information refreshed. Types from
the installed NuGet packages are then available in projects that
reference this updated project either directly or indirectly.</p>

<p><strong>Fixed transitive project references after editing a project file</strong></p>

<p>Given a solution that contains three .NET Standard projects: LibC references
LibB which references LibA. If a NuGet package is added to LibA by
editing its project file in the text editor the types from this NuGet
package were not available to LibB or LibC without restarting Visual Studio
for Mac or until the packages were restored for the solution. Now when the project file
is saved the projects that directly or indirectly reference the project
will be restored.</p>

<p><strong>Ignore project references with ReferenceOutputAssembly set to false when restoring</strong></p>

<p>Project references that have ReferenceOutputAssembly are now not
added to the project.assets.json file. This was causing
the NuGet package restore to fail in some cases. For example, if a .NET Standard
project has a project reference to a .NET Core App project, but has the
ReferenceOutputAssembly set to false, then running dotnet restore from the
command line would work, but the restore would fail in Visual Studio for Mac.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/10/28/NuGetSupportInVisualStudioMac7-2/">NuGet Support in Visual Studio for Mac 7.2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-10-28T12:00:00+01:00" pubdate data-updated="true">Oct 28<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Changes</h2>

<ul>
<li> NuGet 4.3.1 support</li>
<li> NuGet fallback folders support</li>
<li> AssetTargetFallback support</li>
<li> NuGet operations can be cancelled on closing the solution</li>
<li> Fixed transitive types from references not being available</li>
<li> Fixed credential dialog being shown multiple times on opening a solution</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.2</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes#release-date-october-9-2017---visual-studio-2017-for-mac-720636">release notes</a>.</p>

<h2>NuGet 4.3.1 support</h2>

<p>NuGet 4.3.1.4445 is now included with Visual Studio for Mac 7.2.</p>

<p>NuGet 4.3.1 includes <a href="https://github.com/NuGet/Home/issues/5806">a fix for imports in the project.json file being ignored</a> which could cause a NuGet package
to incorrectly be considered incompatible when restoring NuGet packages.</p>

<h2>NuGet package fallback folders support</h2>

<p>The .NET Core SDK 2.0 defines a NuGet package fallback folder <code>/usr/local/share/dotnet/sdk/NuGetFallbackFolder</code> that can be used when looking
for NuGet packages whilst restoring. This fallback folder is now supported by
Visual Studio for Mac 7.2 so that on restoring a .NET Core 2.0 project the NuGet
packages from the fallback folder will be found and do not need to be downloaded from nuget.org into the
local machine NuGet package cache <code>~/.nuget/packages</code>. This should speed up NuGet package restore for .NET Core 2.0 and .NET Standard 2.0 projects the first time it occurs.</p>

<p>As well as the NuGet fallback folders Visual Studio for Mac will now add the following items to the generated project.assets.json
if they are available:</p>

<ul>
<li>configFilePaths</li>
<li>sources</li>
<li>warningProperties</li>
</ul>


<h2>AssetTargetFallback support</h2>

<p>The .NET Core 2.0 SDK uses an AssetTargetFallback MSBuild property
defined in an imported SDK MSBuild files. This is used instead
of the PackageTargetFallback property when determining if a NuGet
package is compatible. Currently the AssetTargetFallback property
is set to net461 by the .NET Core 2.0 SDK which allows .NET Core projects to use NuGet
packages that include assemblies that target the full .NET Framework.
The supported fallback frameworks are now added to the generated
project.assets.json file by Visual Studio for Mac when a .NET Core 2.0 project is restored.</p>

<h2>NuGet operations can be cancelled on the closing the solution</h2>

<p>Previously when closing the solution, or closing Visual Studio for Mac, when a NuGet package
operation was still running would result in a dialog being displayed saying that the
solution cannot be closed until the NuGet operation was completed.
NuGet v3 and above now allow the NuGet
operations to be cancelled so now the dialog allows the current
operation to be cancelled. If the
operation is taking a while to cancel a busy spinner image will be displayed in
the dialog.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-2/CancelNuGetOperationOnClosingSolutionDialog.png" title="Cancel NuGet operation dialog on closing solution" alt="Cancel NuGet operation dialog on closing solution"></p>

<p>If a restore is being run when the solution
will be closed the restore will be cancelled automatically without showing the dialog.</p>

<h2>NuGet package restore now fails if package and asset target fallbacks are defined by a project</h2>

<p>If both AssetTargetFallback and PackageTargetFallback are defined by a project then the
NuGet restore will fail with an error indicating that they cannot
be used together. This mirrors the behaviour of the .NET Core command
line restore.</p>

<h2>Support imported package references in non .NET Core projects</h2>

<p>If a non .NET Core project had no PackageReference items but imported a file that
did have PackageReference items the NuGet packages were not restored
on opening the solution. This was because only the PackageReference
items defined directly in the project were checked to determine if the
project used NuGet packages. Now the evaluated MSBuild items are checked
so any imported PackageReference items are detected and a restore
will be run on opening the solution.</p>

<p>Note that imported PackageReference items are not displayed in the
Packages folder.</p>

<h2>Package Console is no longer opened when a NuGet operation is cancelled</h2>

<p>When a NuGet operation is cancelled from the main status bar the
Package Console is now not opened when the NuGet operation fails due
to the cancellation. If the NuGet operation is not cancelled then the
Package Console window will still be opened as before if the operation fails.
This is also a workaround for Visual Studio for Mac closing the currently displayed
dialog when the Package Console window opens after the NuGet operation
is cancelled when closing the solution.</p>

<h2>Whitespace is now trimmed when creating a new package source</h2>

<p>When creating a new package source copying and pasting NuGet package source url can sometimes copy extra
whitespace which can then result in NuGet package restore errors such as:</p>

<pre><code>Failed to verify the root directory of local source
' https://api.nuget.org/v3/index.json'.
</code></pre>

<p>The package source name and url will now have whitespace trimmed to avoid
this copy and paste problem. This also
matches Visual Studio on Windows behaviour.</p>

<h2>Mark implicit PackageReferences as auto referenced</h2>

<p>PackageReference items that have IsImplicitlyDefined set to true
in their metadata now have autoRefererenced set to true in the project.assets.json file.</p>

<h2>Bug Fixes</h2>

<p><strong>Fixed transitive assembly references not available until restart</strong></p>

<p>Given a solution that contains three .NET Standard projects: LibC
references LibB which references LibA. If the Newtonsoft.Json NuGet
package was installed into LibA the types from this NuGet package
were not available in LibB or LibC until the solution was closed and
re-opened again. Closing and re-opening the solution refreshes the
reference information used by the type system. Now when a NuGet
package is installed into a .NET Core project the projects that
reference this project have their reference information refreshed. Types from
the installed NuGet packages are then available in projects that
reference this updated project either directly or indirectly.</p>

<p><strong>Fixed transitive project references after editing a project file</strong></p>

<p>Given a solution that contains three .NET Standard projects: LibC references
LibB which references LibA. If a NuGet package is added to LibA by
editing its project file in the text editor the types from this NuGet
package were not available to LibB or LibC without restarting Visual Studio
for Mac or until the packages were restored for the solution. Now when the project file
is saved the projects that directly or indirectly reference the project
will be restored.</p>

<p><strong>Fixed credential dialog shown multiple times on opening a solution</strong></p>

<p>With check for updates enabled, multiple projects in the solution,
and a package source that was missing or had invalid credentials,
on opening the solution the credential dialog would be displayed multiple
times even if the correct username and password was entered or the
dialog was cancelled. The dialog was being displayed for each
project and the credential information was not being re-used.</p>

<p>Now the NuGet source repositories are re-used when checking
for updates and also when restoring the projects when the solution
is first opened. Any valid credentials entered will be re-used
when checking the remaining projects. If the credential dialog is
cancelled then the dialog is no longer displayed again whilst
checking for updates for the other projects.</p>

<p><strong>Fixed credential dialog displayed when credentials are available</strong></p>

<p>With valid credentials stored in the Mac key chain the credential dialog would
still be displayed when it should not have been. The problem was that the
NuGet credential service puts itself in a retry mode if any of the
credential providers are used when trying to authenticate against a
package source. Once in this retry mode the Visual Studio for Mac credential
provider would always show a dialog asking for the credentials instead
of re-using the existing credentials. To avoid this the credential
service is reset before any user actions, such as opening the Add Packages
dialog, running a restore or an update.</p>

<p><strong>Fixed crash when displaying Chinese characters in the Add Packages dialog</strong></p>

<p>With the NuGet v3 package source <a href="https://api.nuget.org/v3/index.json">https://api.nuget.org/v3/index.json</a>
selected, searching for Microsoft.AspNet.WebApi.Client would result in
the Visual Studio for Mac terminating when an attempt was made to display the results
in the Add Packages dialog.
The crash was in the Pango library when it attempted to determine the size of
the package title displayed in the search results. If the package
title contained Chinese characters then Pango would throw an exception:</p>

<pre><code>Illegal byte sequence encounted in the input.
at (wrapper managed-to-native) Pango.Layout:pango_layout_get_pixel_size (intptr,int&amp;,int&amp;)
</code></pre>

<p>Then when Visual Studio for Mac tried to use Pango again to determine the
size of the text this would result in Visual Studio for Mac terminating.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Pango-WARNING (recursed) **: shaping failure, expect ugly output.
</span><span class='line'>shape-engine='BasicEngineCoreText', font='.SF NS Text',
</span><span class='line'>text=''Stacktrace:
</span><span class='line'>
</span><span class='line'>  at &lt;unknown&gt; &lt;0xffffffff&gt;
</span><span class='line'>  at (wrapper managed-to-native) Pango.Layout.pango_layout_get_pixel_size (intptr,int&,int&) [0x0000b] in &lt;c7aa2d93df4045df8dc71d5439f99d72&gt;:0</span></code></pre></td></tr></table></div></figure>


<p>If the NuGet v2 package source was used then this crash did not occur
since the package title was not returned in the search results and the package id would be
displayed instead which does not contain Chinese characters.</p>

<p>As a workaround the Add Packages dialog now displays the package id
instead of the package title.</p>

<p><strong>Ignore project references with ReferenceOutputAssembly set to false when restoring</strong></p>

<p>Project references that have ReferenceOutputAssembly are now not
added to the project.assets.json file. This was causing
the NuGet package restore to fail in some cases. For example, if a .NET Standard
project has a project reference to a .NET Core App project, but has the
ReferenceOutputAssembly set to false, then running dotnet restore from the
command line would work, but the restore would fail in Visual Studio for Mac.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/08/26/NuGetSupportInVisualStudioMac7-1/">NuGet Support in Visual Studio for Mac 7.1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-08-26T14:00:00+01:00" pubdate data-updated="true">Aug 26<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>New Features</h2>

<ul>
<li> NuGet 4.3 support</li>
<li> Support PackageReference in non .NET Core projects</li>
<li> Enable file template when a NuGet package is installed</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.1</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes#release-date-august-14-2017---visual-studio-for-mac-7101297">release notes</a>.</p>

<h2>NuGet 4.3 Support</h2>

<p>NuGet 4.3.0.2418 is now included with Visual Studio for Mac 7.1.</p>

<p>This version of NuGet adds support for .NET Core 2.0 and .NET Standard 2.0
target frameworks.</p>

<h2>Support PackageReference in non .NET Core projects</h2>

<p>Non .NET Core Sdk style projects that use a PackageReference MSBuild item are now supported.</p>

<pre><code>&lt;PackageReference Include="Newtonsoft.Json"&gt;
  &lt;Version&gt;10.0.1&lt;/Version&gt;
&lt;/PackageReference&gt;
</code></pre>

<p>In Visual Studio for Mac 7.0 the Solution
window would not show any packages for the project, would not allow
the packages to be restored, and would create a packages.config file when installing
a NuGet package even though the project was using PackageReferences.</p>

<p>Now if the project has a PackageReference the Packages folder
shows the installed packages and can be used to update or install
NuGet packages which will also create PackageReference MSBuild items.</p>

<p>If the project has no PackageReferences then by default a
packages.config file will be created when a NuGet package is installed.</p>

<p>Currently it is not possible to opt-in to using PackageReferences by default.
So the project file will need to be edited in the text editor to include at
least one PackageReference before the default behaviour of using a packages.config
file is overridden.</p>

<h2>Enable file template when a NuGet package is installed</h2>

<p>A file template can now specify that it should be enabled if the project
has a specific reference or has a specific NuGet package installed.
Previously it was only possible to enable a file template based on the
references defined in the project file.</p>

<pre><code>&lt;HasPackageOrReference PackageId="Xamarin.Forms" Assembly="Xamarin.Forms" /&gt;
</code></pre>

<p>Whilst a reference will work for projects that use a packages.config
file, if the project uses a project.json file or PackageReferences
then checking the references defined in the project would not find any matches and
the file template would not be enabled.</p>

<h2>Bug Fixes</h2>

<p><strong>Do not require description when creating a new NuGet package project</strong></p>

<p>When creating a NuGet package project or a multiplatform project the description
needed to be specified in the New Project dialog.</p>

<p>To simplify the project creation
process the package id is used as the description by default. As you type the
package id into the New Project dialog the description text
box will be updated. The description can be changed to be different
to the package id if required.</p>

<p><strong>Fix being unable to load NuGet Package Project created by Visual Studio on Windows</strong></p>

<p>Visual Studio on Windows creates a NuGet package project (.nuproj)
with no target framework version which resulted in 4.0 being used by
default in Visual Studio for Mac. This would cause the project to fail to
load in Visual Studio for Mac since it was checking for 4.5 or later.</p>

<p><strong>Fix no packages shown in Packages folder for NuGet Package Projects</strong></p>

<p>Opening a previously created NuGet package project (.nuproj) would show no
packages in the Packages folder.</p>

<p>The problem was that the PackageReference project item was defined by
both the NuGet addin and the Packaging addin. The NuGet addin&rsquo;s PackageReference
project item was used instead of the one defined by the Packaging addin so no
package references were found for the NuGet package project.</p>

<p><strong>Fix NuGet Package Project&rsquo;s MSBuild targets not being created</strong></p>

<p>If the NuGet package project&rsquo;s generated .nuget.targets or .nuget.props are missing
then these are now created on opening the solution if
automatic restore is enabled.</p>

<p><strong>Fix being unable to package .NET Standard projects</strong></p>

<p>A NuGet package project that referenced an Sdk style .NET Standard project
would fail to build the NuGet package. The build would fail with an error:</p>

<pre><code>Error: Project targets '.NETStandard,Version=v1.4'. It cannot be
referenced by a project that targets 'NuGet,Version=v1.0'
</code></pre>

<p>Updating to a more recent NuGet.Build.Packaging NuGet
package, such as version 0.1.276, fixes this problem.</p>

<p><strong>NuGet Package project treated as .NET Core project</strong></p>

<p>NuGet package projects (.nuproj) that use the NuGet.Build.Packaging
0.1.276 NuGet package define a TargetFramework property in an
imported MSBuild .props file. This was causing the project to
be treated as a .NET Core project by Visual Studio for Mac. This caused
the Dependencies folder to be displayed and the References folder
to be removed. Visual Studio for Mac now checks the project has the
Sdk attribute instead of looking at the MSBuild properties defined
by the project when determining the project type.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/08/23/NetCoreSupportInVisualStudioMac7-1/">.NET Core Support in Visual Studio for Mac 7.1</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-08-23T21:00:00+01:00" pubdate data-updated="true">Aug 23<sup>rd</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>New Features</h2>

<ul>
<li> .NET Core 2.0 support</li>
<li> Target framework selection for new projects</li>
<li> New project templates</li>
<li> .NET Core Runtimes and SDKs displayed in About Dialog</li>
<li> Improved support for multi target framework projects</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.1</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes#release-date-august-14-2017---visual-studio-for-mac-7101297">release notes</a>.</p>

<h2>.NET Core 2.0 Support</h2>

<p>Visual Studio for Mac 7.1 adds support for <a href="https://blogs.msdn.microsoft.com/dotnet/2017/08/14/announcing-net-core-2-0/">.NET Core 2.0</a> and .NET Standard 2.0.</p>

<p>The .NET Core 2.0 SDK needs to be <a href="https://www.microsoft.com/net/download/core">installed</a> separately.</p>

<h2>Target Framework Selection for New Projects</h2>

<p>If a project template supports multiple target frameworks, and the corresponding framework is available, then the New Project dialog will allow the framework to be selected before the project is created.</p>

<p><img src="/images/blog/DotNetCoreSupportInVisualStudioMac7-1/NewNetCoreProjectTargetFrameworkSelection.png" title="New .NET Core target framework selection" alt="New .NET Core target framework selection"></p>

<p>Visual Studio for Mac includes project templates for .NET Core 1.0, 1.1 and 2.0 as well as for .NET Standard versions 1.0 through to 2.0.</p>

<p>To be able to create projects that target .NET Core 2.0 or .NET Standard 2.0 the .NET Core 2.0 SDK needs to be installed.</p>

<h2>New Project Templates</h2>

<p>The following project templates have been added:</p>

<ul>
<li>ASP.NET Core Web App (Razor Pages)

<ul>
<li>Available if .NET Core 2.0 SDK is installed.</li>
</ul>
</li>
<li>Class Library

<ul>
<li>Targets .NET Core instead of .NET Standard.</li>
</ul>
</li>
<li>MSTest</li>
</ul>


<p>Some project templates do not support all the target framework versions.
For example, the ASP.NET Core Web App (Razor Pages) only supports
.NET Core 2.0, so this template will only be displayed if .NET Core 2.0 SDK
is installed.</p>

<p>The F# project templates have some restrictions on what target frameworks
they support. The F# .NET Standard project templates do not
support selecting .NET Standard versions below 1.6. The F# Class Library project
only supports .NET Core 2.0.</p>

<h2>.NET Core Runtime and SDKs displayed in About Dialog</h2>

<p>The About dialog will now display the .NET Core runtimes and SDKs that are installed on
the local machine.</p>

<p><img src="/images/blog/DotNetCoreSupportInVisualStudioMac7-1/NetCoreInformationAboutDialog.png" title=".NET Core runtime and SDK information in About dialog" alt=".NET Core runtime and SDK information in About dialog"></p>

<h2>Improved Support for Multi Target Framework Projects</h2>

<p>SDK style projects that target multiple frameworks can now be opened in Visual Studio for
Mac 7.1 and will show source files as well as NuGet package dependencies.</p>

<p>The project will be treated as though it only has
one target framework which is the first one specified in the
TargetFrameworks property in the project file.</p>

<p>Please note that currently the support for multiple target frameworks is limited in
comparison with Visual Studio on Windows.</p>

<h2>Bug Fixes</h2>

<p><strong>ASP.NET Core Web API project does not open API url on launching browser</strong></p>

<p>When an ASP.NET Core Web API project was run it would open a blank web
page in the browser instead of a page that showed the api values. Now when a new ASP.NET
Core Web API project is run the <code>http://localhost:&lt;port&gt;/api/values</code> url is launched in
the browser so the API values will be displayed.</p>

<p><strong>Unable to run or debug ASP.NET Core project with empty SDK directory</strong></p>

<p>If there was an empty directory inside the .NET Core SDK directory <code>/usr/local/share/dotnet/sdk</code> then it was
not possible to run or debug an ASP.NET Core web project</p>

<p>If the .NET Core SDK MSBuild files were not found in the SDK directory then the
project&rsquo;s OutputType was not read and would result in the project being treated
as a library project. This could also occur if only
the .NET Core runtime is installed.</p>

<p><strong>Shared project files shown for .NET Core project in Solution window</strong></p>

<p>When a .NET Core project referenced a shared assets project the files
from the shared project were incorrectly being displayed in the .NET Core project in
the Solution window.</p>

<p><strong>Fix generated code for resource files in .NET Core projects</strong></p>

<p>Adding a resx file to a .NET Core 1.x or .NET Standard 1.x project would result in
code being generated that could not be compiled.</p>

<p>Projects that target .NET Core App 1.0, 1.1, or .NET Standard below version 2.0
cannot compile code that uses <code>typeof(Resources).Assembly</code> which was
being generated by the ResXFileCodeGenerator. If these target frameworks
are used by the project then the code generated by Visual Studio for Mac
will now use <code>typeof(Resources).GetTypeInfo().Assembly</code> which is supported.</p>

<p>.NET Core 2.0 and .NET Standard 2.0 do not need to use GetTypeInfo so the
code generated for these frameworks has not been changed.</p>

<p><strong>Fix new resource file not added as Update item in Sdk projects</strong></p>

<p>Adding a new resource file to a .NET Core project would add the
.resx file and the .Designer.cs file as Include items instead of an
Update items.</p>

<pre><code>&lt;ItemGroup&gt;
  &lt;EmbeddedResource Include="Resources.resx"&gt;
    &lt;Generator&gt;ResXFileCodeGenerator&lt;/Generator&gt;
    &lt;LastGenOutput&gt;Resources.Designer.cs&lt;/LastGenOutput&gt;
  &lt;/EmbeddedResource&gt;
&lt;/ItemGroup&gt;
&lt;ItemGroup&gt;
  &lt;Compile Include="Resources.Designer.cs"&gt;
    &lt;DependentUpon&gt;Resources.resx&lt;/DependentUpon&gt;
  &lt;/Compile&gt;
&lt;/ItemGroup&gt;
</code></pre>

<p>This then caused the build to fail since these files are already included by
the .NET Core SDK.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/08/06/ConfiguringOpenWithInVisualStudioMac7-0/">Configuring Open With in Visual Studio for Mac 7.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-08-06T12:00:00+01:00" pubdate data-updated="true">Aug 6<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Visual Studio on Windows can be <a href="https://msdn.microsoft.com/en-us/library/hy2sthf1.aspx">configured to use a different editor to open a file</a>. With Visual Studio for Mac, whilst you can open a file with a selection of editors and applications, it is not currently possible to change the default editor or add a custom application.</p>

<p>The <a href="https://github.com/mrward/monodevelop-open-with-addin">Open With addin</a> provides an Open With dialog that allows you to change the default editor or application used to open a file in a similar way to how this is done in Visual Studio on Windows.</p>

<h2>Features</h2>

<ul>
<li>Supports changing the default editor used to open a file.</li>
<li>Supports adding a custom application to open a file.</li>
<li>Editor configuration is saved and will be available on restarting Visual Studio for Mac.</li>
</ul>


<h2>Supports</h2>

<ul>
<li>Visual Studio Mac 7.0 or later.</li>
</ul>


<h2>Configuring the Default Editor or Application</h2>

<p>To configure the application or editor used to open file you can right click the file in the Solution window and select Open With &ndash; Preferences&hellip;</p>

<p><img src="/images/blog/ConfiguringOpenWithInVisualStudioMac7-0/OpenWithPreferencesMenu.png" title="Open With - Preferences context menu" alt="Open With - Preferences context menu"></p>

<p>This will open the Open With dialog.</p>

<p><img src="/images/blog/ConfiguringOpenWithInVisualStudioMac7-0/OpenWithDialog.png" title="Open With dialog" alt="Open With dialog"></p>

<p>The editors and applications that support opening the file are displayed. The default application is indicated by having (Default) next to its name.</p>

<p>To change the default application or editor used to open the file select it and then click the Set as Default button. Click OK to close the dialog and save the configuration.</p>

<p>If a file is currently open then it will need to be closed before it is opened in the new default editor or application.</p>

<h2>Adding a Custom Application</h2>

<p>A custom application can be added to the list of applications shown in the Open With menu. First open the Open With dialog by selecting Open With &ndash; Preferences. Then click the Add button to open the Add Application dialog.</p>

<p><img src="/images/blog/ConfiguringOpenWithInVisualStudioMac7-0/AddApplicationDialog.png" title="Add Application dialog" alt="Add Application dialog"></p>

<p>The Browse button can be used to find an application.</p>

<p>The Friendly Name is the name that will be displayed in the Open With menu for the custom application.</p>

<p>Arguments cannot be specified if a Mac application (.app) is used. However if the application is not a Mac application, for example, it is a C# program, then arguments can be passed. To pass the filename to the program you can use {0} in the Arguments text box. This placeholder will be expanded to be the full filename path when the program is run.</p>

<h2>Removing a Custom Application</h2>

<p>To remove a custom application for a file first open the Open With dialog by selecting Open With &ndash; Preferences. Select the application you want to remove. Then click the Remove button.</p>

<p>The Remove button is only enabled for custom applications that you have added. The built-in editors and applications cannot be removed.</p>

<h2>Installation</h2>

<p>The Open With addin is available to download from <a href="https://github.com/mrward/monodevelop-open-with-addin/releases/download/0.1/MonoDevelop.OpenWith_0.1.mpack">GitHub</a>.</p>

<p>To install the addin open the Extensions Manager by selecting Extensions&hellip; from the main menu. Click the Install from file button. Select the .mpack file and then click the Open button.</p>

<p>The addin is also in the Extensions Manager from the
<a href="http://addins.monodevelop.com/Project/Index/306">Visual Studio Extension Repository (Beta channel)</a>.</p>

<h2>Source Code</h2>

<ul>
<li><a href="https://github.com/mrward/monodevelop-open-with-addin">Open With addin for Visual Studio for Mac</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/06/04/NuGetSupportInVisualStudioMac7-0/">NuGet Support in Visual Studio for Mac 7.0</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-06-04T12:00:00+01:00" pubdate data-updated="true">Jun 4<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>New Features</h2>

<ul>
<li> .NET Core support</li>
<li> NuGet 4.0 support</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.0</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes">release notes</a>.</p>

<h2>.NET Core Support</h2>

<p>.NET Core projects do not show a Packages folder in the Solution window. Instead the NuGet packages are displayed in a NuGet folder, which is inside a Dependencies folder.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-0/NetCoreProjectJsonNetPackageInSolutionWindow.png" title="Newtonsoft.Json NuGet package in Solution window - .NET Core project" alt="Newtonsoft.Json NuGet package in Solution window - .NET Core project"></p>

<p>The version of the NuGet package is displayed directly in the Solution window. For other project types you need to right click the package to see the version.</p>

<p>If the NuGet package depends on other packages then these can be seen by clicking on the arrow to expand the dependencies.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-0/NetCoreProjectJsonNetPackageExpandedInSolutionWindow.png" title="Newtonsoft.Json NuGet package expanded in Solution window - .NET Core project" alt="Newtonsoft.Json NuGet package expanded in Solution window - .NET Core project"></p>

<h3>Restoring Packages</h3>

<p>NuGet packages will be restored automatically on opening a .NET Core project. This can be disabled in preferences by unchecking <strong>Automatically restore packages when opening a solution</strong> in the NuGet &ndash; General section.</p>

<p>You can manually restore NuGet packages for .NET Core projects by:</p>

<ul>
<li>Right clicking the Dependencies folder and selecting Restore.</li>
<li>Right clicking the NuGet folder and selecting Restore.</li>
<li>Selecting Restore NuGet Packages from the Project menu.</li>
</ul>


<p>Selecting Restore NuGet Packages from the Project menu will restore packages for the project or the solution depending on what is currently selected in the Solution window.</p>

<p>Restoring NuGet packages for a .NET Core project works differently compared with a project that uses a packages.config file. The NuGet packages themselves will be downloaded into the NuGet package cache folder ~/.nuget/packages if they do not exist, as before, but the NuGet packages will not be copied into a packages directory inside the solution&rsquo;s directory. The project file will not contain have any Reference items added when a NuGet package is installed.</p>

<p>When a NuGet restore is run for a .NET Core project three files in the obj directory are created.</p>

<ul>
<li>project.assets.json</li>
<li>ProjectName.csproj.nuget.g.props</li>
<li>ProjectName.csproj.nuget.g.targets</li>
</ul>


<p>The project.assets.json file contains the dependencies for your project.</p>

<p>The nuget.g.props and nuget.g.targets files will contain any MSBuild imports that your NuGet package requires and they also define some properties, such as the path to the NuGet package cache on your machine.</p>

<p>These three files are used when building your project to resolve the assemblies to be referenced now that they are no longer explicitly stored in your project file.</p>

<h3>Updating Packages</h3>

<p>NuGet packages can be updated by:</p>

<ul>
<li>Right clicking the package inside the NuGet folder and selecting Update.</li>
<li>Right clicking the NuGet folder and selecting Update.</li>
<li>Right clicking the Dependencies folder and selecting Update.</li>
<li>Selecting Update NuGet Packages from the Project menu.</li>
</ul>


<p>Selecting Update NuGet Packages from the Project menu will update all packages in the project or in the solution depending on what is currently selected in the Solution window.</p>

<h3>Removing Multiple NuGet Packages in One Step</h3>

<p>You can remove multiple NuGet packages in one step from a .NET Core project by selecting the packages in the Solution window, right clicking and selecting Remove.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-0/NetCoreProjectRemoveMultipleNuGetPackagesInSolutionWindow.png" title="Removing multiple NuGet packages in Solution window - .NET Core project" alt="Removing multiple NuGet packages in Solution window - .NET Core project"></p>

<p>Projects that use a packages.config file do not support removing multiple NuGet packages in one step.</p>

<h3>Installing NuGet Packages</h3>

<p>NuGet packages are installed by using the Add Packages dialog in the same way as with other project types. To open the Add Packages dialog for a .NET Core project:</p>

<ul>
<li>Right click the NuGet folder and select Add Packages&hellip;</li>
<li>Right click the Dependencies folder and select Add Packages&hellip;</li>
<li>Right click the project and select Add &ndash; Add NuGet Packages&hellip;</li>
<li>From the Project menu select Add NuGet Packages&hellip;</li>
</ul>


<p>When the first NuGet package is installed into a .NET Core project a packages.config file will not be created. Instead the NuGet package will be added as a <a href="https://docs.microsoft.com/en-us/nuget/consume-packages/package-references-in-project-files">PackageReference</a> that is saved in the project file.</p>

<h3>Package Reference</h3>

<p>.NET Core projects do not use a packages.config file to record their NuGet dependencies. Instead the .NET Core project file will contain a <a href="https://docs.microsoft.com/en-us/nuget/consume-packages/package-references-in-project-files">PackageReference</a> after the NuGet package is installed into the project.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;Project Sdk="Microsoft.NET.Sdk"&gt;
</span><span class='line'>
</span><span class='line'>  &lt;PropertyGroup&gt;
</span><span class='line'>    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
</span><span class='line'>    &lt;TargetFramework&gt;netcoreapp1.1&lt;/TargetFramework&gt;
</span><span class='line'>  &lt;/PropertyGroup&gt;
</span><span class='line'>
</span><span class='line'>  &lt;ItemGroup&gt;
</span><span class='line'>    &lt;PackageReference Include="Newtonsoft.Json" Version="10.0.2" /&gt;
</span><span class='line'>  &lt;/ItemGroup&gt;
</span><span class='line'>&lt;/Project&gt;</span></code></pre></td></tr></table></div></figure>


<p>Please note that Visual Studio for Mac currently only supports package references with the new SDK style projects which are used by .NET Core. If you use package references in other project types then the Solution window will not show the packages and a packages.config file will be created if you install a NuGet package.</p>

<h3>Updated Packages Available</h3>

<p>For other project types the Solution window will check for updated packages and show this information in the Packages folder. This is not currently supported with .NET Core projects.</p>

<h2>NuGet 4.0 Support</h2>

<p>Visual Studio for Mac now includes <a href="https://docs.microsoft.com/en-us/nuget/release-notes/nuget-4.0-rtm">NuGet 4.0</a>.</p>

<p>More information on the new features provided by NuGet 4.&ndash; can be found in the <a href="http://blog.nuget.org/20170308/Announcing-NuGet-4.0-RTM.html">Announcing NuGet 4.0 RTM blog post</a> and the <a href="https://docs.microsoft.com/en-us/nuget/release-notes/nuget-4.0-rtm">NuGet 4.0 release notes</a>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2017/03/05/NuGetSupportInXamarinStudio6-2/">NuGet Support in Xamarin Studio 6.2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2017-03-05T12:00:00+00:00" pubdate data-updated="true">Mar 5<sup>th</sup>, 2017</time>
        
      </p>
    
  </header>


  <div class="entry-content"><ul>
<li> Integrated support for creating NuGet packages with <a href="https://github.com/nuget/nuget.build.packaging">NuGetizer 3000</a></li>
<li> NuGet 3.5 support</li>
<li> Improved project.json support</li>
<li> Native License Acceptance dialog</li>
</ul>


<p>More information on all the new features and changes in Xamarin Studio 6.2 can be found in the <a href="https://developer.xamarin.com/releases/studio/xamarin.studio_6.2/xamarin.studio_6.2/">release notes</a>.</p>

<h2>NuGetizer 3000</h2>

<p><a href="https://github.com/nuget/nuget.build.packaging">NuGetizer 3000</a> is a set of build tools for creating NuGet packages inspired by <a href="http://nuproj.net/">NuProj</a>. Support for NuGetizer 3000 in Xamarin Studio includes:</p>

<ul>
<li>Project templates for creating NuGet packages</li>
<li>Support for creating a NuGet package from an existing project</li>
<li>Reference assembly generation for Portable Class Library profiles</li>
</ul>


<p>The following sections look at the NuGetizer 3000 features provided by Xamarin Studio. For more detailed information on what is supported by NuGetizer 3000 please read the <a href="https://github.com/NuGet/Home/wiki/NuGetizer-3000">NuGetizer 3000 feature spec</a>.</p>

<h3>Project Templates</h3>

<p>There are two new project templates available.</p>

<ul>
<li>Multiplatform Library</li>
<li>NuGet package</li>
</ul>


<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/MultiplatformLibraryNewProjectDialog.png" title="Mulitplatform Library project template in New Project dialog" alt="Mulitplatform Library project template in New Project dialog"></p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/NuGetPackageNewProjectDialog.png" title="NuGet Package project template in New Project dialog" alt="NuGet Package project template in New Project dialog"></p>

<h3>Multiplatform Library &ndash; Single for all platforms</h3>

<p>The Mulitplatform Library project template will create a Portable Class Library project with NuGet package metadata when the Single for all platforms option is selected.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/MultiplatformLibraryWizardSingleSelected.png" title="Multiplatform library - single for all platforms selected" alt="Multiplatform library - single for all platforms selected"></p>

<p>To create a NuGet package right click the project and select Create NuGet Package. This will generate a NuGet package (.nupkg) in the output directory with the Portable Class Library assembly in the corresponding portable lib directory inside the NuGet package.</p>

<h3>Multiplatform Library &ndash; Platform specific</h3>

<p>This Multiplatform Library will create a shared project, an iOS project, an Android project and a NuGet packaging project when the iOS and Android options are selected.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/MultiplatformLibraryWizardPlatformsSelected.png" title="Multiplatform library - iOS and Android selected" alt="Multiplatform library - iOS and Android selected"></p>

<p>The iOS and Android project will reference the shared project. The NuGet packaging project will reference the iOS and Android projects. The NuGet packaging project will contain the NuGet package metadata.</p>

<p>When the NuGet packaging project is built it will create the NuGet package in its output folder and inside the NuGet package will be the Android and iOS output assemblies each in their own platform specific lib folders.</p>

<h3>NuGet Packaging Project</h3>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/NuGetPackageWizard.png" title="NuGet package project template configuration" alt="NuGet package project template configuration"></p>

<p>The NuGet packaging project can be used to create a meta NuGet package, which is a NuGet package that has no content itself but references other NuGet packages, or it can reference other projects and it will add their output assemblies to the NuGet package. If the referenced project has NuGet package references then these will be added to the generated NuGet package as dependencies.</p>

<p>NuGet packages can be added to the NuGet packaging project by using the Add Packages dialog.</p>

<p>To include files in the NuGet packaging project the files need to have Include in Package property set to true. This can be done by right clicking the file in the solution window, selecting Properties, then selecting Include in Package from the NuGet section in the Properties window.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/IncludeInPackagePropertiesWindow.png" title="Include in Package in Properties window" alt="Include in Package in Properties window"></p>

<h3>Adding NuGet Package Metadata</h3>

<p>NuGet package metadata can be added to any .NET project by selecting the NuGet Package &ndash; Metadata page available in the project options.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/NuGetPackageMetadataProjectOptions.png" title="NuGet Package metadata in project options" alt="NuGet package metadata in project options"></p>

<p>The General tab shows compulsory metadata that must be specified for a NuGet package. The Details tab shows other optional metadata that can be specified. This NuGet package metadata is saved directly into the project file (.csproj).</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/NuGetPackageMetadataDetailsProjectOptions.png" title="NuGet Package metadata in project options" alt="NuGet package metadata in project options"></p>

<p>Once NuGet package metadata has been added then the NuGet.Build.Packaging NuGet package will be added to the project if it does not already exist. This NuGet package provides MSBuild tasks that are used when creating the NuGet package for the project.</p>

<p>NuGet package metadata should be added to project if you want to be able to create a NuGet package for that project on its own. Without NuGet package metadata the project would need to be referenced by a NuGet packaging project, or another project with NuGet package metadata, for it to be included in a NuGet package.</p>

<p>If a NuGet packaging project references a project that has its own NuGet package metadata then a dependency will be added to the NuGet package created by the NuGet packaging project. The referenced project&rsquo;s output assembly would not be included in the NuGet package created by the packaging project in this case.</p>

<h3>Generating a NuGet Package</h3>

<p>To generate a NuGet package you can right click the project and select Create NuGet Package.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/CreateNuGetPackageMenuItem.png" title="Create NuGet Package menu item" alt="Create NuGet Package menu item"></p>

<p>For NuGet packaging projects you can also build the project and it will create a NuGet package.</p>

<p>For a .NET project that has NuGet package metadata you can generate a NuGet package when building the project by enabling the &ldquo;Create a NuGet Package when building the project&rdquo; option in the Project Options dialog.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/CreateNuGetPackageWhenBuildingOption.png" title="Creating a NuGet Package when building the project option - project options" alt="Creating a NuGet Package when building the project - project options"></p>

<h3>Adding Platform Implementations</h3>

<p>If you have a Portable Class Library with NuGet package metadata you can add platform specific implementations for iOS and Android by right clicking the project and selecting Add &ndash; Add Platform Implementation. This will open a dialog where you can choose iOS and Android, and also whether to create a shared project.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/AddPlatformImplementationDialog.png" title="Add Platform Implementation dialog" alt="Add Platform Implementation dialog"></p>

<p>After clicking OK an Android and iOS project will be created along with a NuGet packaging project that references these projects. The NuGet package metadata will be moved from the Portable Class Library project to the NuGet packaging project. If the shared project option was selected then the code from the Portable Class Library project will be moved to the shared project. The shared project will be referenced by the iOS and Android project.</p>

<h3>Reference Assembly Generation</h3>

<p>In the Project Options for a NuGet Packaging project there is a Reference Assemblies page in the NuGet Package category. This pages shows a list of Portable Class Library profiles that can be selected.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/ReferenceAssembliesProjectOptions.png" title="Reference assemblies in project options" alt="Reference assemblies in project options"></p>

<p>Reference assemblies for the selected profiles will be generated based on the output assemblies from the projects referenced by the NuGet packaging project.</p>

<p>That brings us to the end of the walkthrough of the NuGetizer 3000 features provided by Xamarin Studio.</p>

<h2>NuGet 3.5 Support</h2>

<p>Xamarin Studio now includes <a href="https://docs.microsoft.com/en-us/nuget/release-notes/nuget-3.5-rtm">NuGet 3.5</a>.</p>

<p>More information on the new features provided by NuGet 3.5 can be found in the <a href="http://blog.nuget.org/20161027/Announcing-NuGet-3.5-RTM.html">Announcing NuGet 3.5 RTM blog post</a> and the <a href="http://docs.nuget.org/ndocs/release-notes/nuget-3.5-RTM">NuGet 3.5 release notes</a>.</p>

<h2>Improved project.json Support</h2>

<p>NuGet packages are now automatically restored when the project.json file is saved in the text editor.</p>

<h2>Native License Acceptance Dialog</h2>

<p>The Licence Acceptance dialog now uses native UI.</p>

<p><img src="/images/blog/NuGetSupportInXamarinStudio6-2/LicenseAcceptanceDialog.png" title="License Acceptance dialog" alt="License Acceptance dialog"></p>

<h2>Bug Fixes</h2>

<p><strong>Updating all NuGet packages installs unexpected pre-release NuGet packages</strong></p>

<p>With a pre-release NuGet package installed in a project, updating
all the NuGet packages in the project could cause the stable NuGet
packages to be updated to pre-release versions. On updating all the packages if any were pre-release the include
pre-release flag would be set on updating which would allow any
pre-release NuGet packages to be used on updating. Now the include pre-release flag is not set on updating. NuGet 3
will still update pre-release NuGet packages to the latest pre-release
or latest stable, depending on which is the latest version, without
this include pre-release flag being set. NuGet 2 required the include
pre-release flag set to update a pre-release to the latest pre-release.</p>

<p>An example &ndash; project has the following NuGet packages
installed:</p>

<pre><code>Xamarin.Forms 2.3.3.180
Xamarin.Forms.CarouselView 2.3.0-pre1
</code></pre>

<p>Latest available packages from nuget.org:</p>

<pre><code>Xamarin.Forms 2.3.3.180 (latest stable)
Xamarin.Forms 2.3.4.184-pre1 (latest pre-release)
Xamarin.Forms.CarouselView 2.3.0-pre2
</code></pre>

<p>Expected result on updating all packages in the project:</p>

<pre><code>Xamarin.Forms 2.3.3.180
Xamarin.Forms.CarouselView 2.3.0-pre2
</code></pre>

<p>Actual result:</p>

<pre><code>Xamarin.Forms 2.3.4.184-pre1
Xamarin.Forms.CarouselView 2.3.0-pre2
</code></pre>

<p><strong>Types unavailable when NuGet package added to project.json file</strong></p>

<p>When a NuGet package was added to a project that used a project.json file
the types from the assembly provided by the NuGet package were not
available until the project was reloaded or the references were
modified. This prevented code completion from showing the correct information.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/blog/archives/">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2020 - Matt Ward -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  










  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
