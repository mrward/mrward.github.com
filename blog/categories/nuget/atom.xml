<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: nuget | Matt Ward]]></title>
  <link href="http://lastexitcode.com/blog/categories/nuget/atom.xml" rel="self"/>
  <link href="http://lastexitcode.com/"/>
  <updated>2018-09-02T14:29:22+01:00</updated>
  <id>http://lastexitcode.com/</id>
  <author>
    <name><![CDATA[Matt Ward]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[NuGet Support in Visual Studio for Mac 7.6]]></title>
    <link href="http://lastexitcode.com/blog/2018/09/01/NuGetSupportInVisualStudioMac7-6/"/>
    <updated>2018-09-01T14:20:00+01:00</updated>
    <id>http://lastexitcode.com/blog/2018/09/01/NuGetSupportInVisualStudioMac7-6</id>
    <content type="html"><![CDATA[<h2>Changes</h2>

<ul>
<li> Support no-op package restore on opening a solution</li>
<li> Added basic support for the NuGet SDK resolver</li>
<li> Fixed source code transformations not available in code completion</li>
<li> Fixed incorrect FSharp.Core NuGet package being restored</li>
<li> Fixed updating PackageReference removing metadata</li>
<li> Fixed build error after updating Xamarin.Forms PackageReference</li>
<li> Fixed build error after updating Xamarin.Forms NuGet package</li>
<li> Fixed editor errors when .NET Standard assembly referenced in Xamarin.iOS project</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.6</a>
can be found in the <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-mac-relnotes#whats-new-in-76">release notes</a>.</p>

<h2>Support no-op package restore on opening a solution</h2>

<p>On opening a solution a NuGet package restore was always run for projects that use
PackageReferences. This resulted in the project.assets.json file being
re-generated and the projects being re-evaluated. Now if the package
references have not changed a no-op restore will occur. This makes the
restore faster on opening a solution. It also prevents Visual Studio for Mac
going online to fetch NuGet package information if a wildcard is used for
a PackageReference or if the package version cannot be found. In the Package
Console when a no-op restore occurs you will see the following
messages:</p>

<pre><code>Assets file has not changed. Skipping assets file writing.
No-Op restore. The cache will not be updated.
</code></pre>

<h2>Allow NuGet SDK resolver to find NuGet SDK packages</h2>

<p>Visual Studio for Mac now has basic support for the
<a href="https://github.com/Microsoft/msbuild/issues/2803">NuGet SDK resolver</a>. The NuGet
SDK resolver will download and install SDKs for SDK style
projects if these SDKs are missing.</p>

<pre><code>&lt;Project Sdk="My.Custom.Sdk/2.3.4"&gt;
  ...
&lt;/Project&gt;
</code></pre>

<p>The SDK resolution is done in the background
when the project is opened and there is currently no visual indication that
this is happening.</p>

<p>The NuGet library assemblies are not available to the remote MSBuild host used by
Visual Studio for Mac so the NuGet SDK resolver was previously failing to load. The NuGet SDK
resolver supports a MSBUILD_NUGET_PATH environment variable which is now set by
Visual Studio for Mac to point to the directory containing the NuGet assemblies
that are included with the IDE.</p>

<h2>Bug Fixes</h2>

<p><strong>Source code transformations not available in code completion</strong></p>

<p>Visual Studio for Mac now ensures that files generated by a NuGet
package are available for code completion. One example
NuGet package that generates files is the
<a href="https://www.nuget.org/packages/LibLog/">LibLog NuGet package</a>.</p>

<p>The LibLog NuGet package has contentFiles that are processed by
MSBuild and converted into .cs files. These .cs files are implicitly included
in the project. These files are generated in the obj folder. For example:</p>

<pre><code>obj/Debug/netstandard2.0/NuGet/SomeID/LibLog/5.0.0/ILog.cs
</code></pre>

<p>The types defined inside these generated files can be referenced by
code in the project. Whilst the project would compile without any errors
the text editor would show errors about the
types from the generated files being undefined.</p>

<p>These generated files are not created or returned by running the
CoreCompileDependsOn MSBuild target, which is currently used to find generated
files. Now when the CoreCompileDependsOn target is evaluated, Visual Studio for
Mac will also run NuGet specific
MSBuild targets to ensure any NuGet package files are generated and
made available for code completion.</p>

<p><strong>Fixed incorrect FSharp.Core NuGet package restored</strong></p>

<p>Installing the FSharp.Core
4.5.0 NuGet package into a F# .NET Core console project would result in
version 4.3.4 of the FSharp.Core NuGet
package being used and displayed in the Dependencies folder. FSharp.Core 4.3.4 is
the NuGet package implicitly added by the F# .NET Core SDK. This was being used by
the project instead of the PackageReference defined in the project.
PackageReferences in the project will now override any implicitly
added NuGet packages. This matches the behaviour of dotnet restore when
run from the command line.</p>

<p><strong>Fixed updating PackageReference removing metadata</strong></p>

<p>On updating a NuGet PackageReference the old PackageReference was
removed from the project file and then a new PackageReference was added.
This resulted in custom MSBuild properties associated with the
PackageReference being removed from the project file.</p>

<pre><code>&lt;PackageReference Include="NuGet.Versioning" Version="3.6.0"&gt;
  &lt;PrivateAssets&gt;all&lt;/PrivateAssets&gt;
&lt;/PackageReference&gt;  
</code></pre>

<p>Now on updating a NuGet package the version of the existing PackageReference element
is updated so any custom MSBuild properties are not removed.</p>

<p><strong>Fixed build error after updating Xamarin.Forms PackageReference</strong></p>

<p>A build error could occur after updating projects that had
a Xamarin.Forms PackageReference. One way to reproduce this was to
have a .NET Standard project that used an old Xamarin.Forms
version as a PackageReference, and another non .NET Core project,
that references the .NET Standard project, which used a newer
Xamarin.Forms NuGet package. On building an
error would be displayed:</p>

<pre><code>Error XF002: Xamarin.Forms tasks do not match targets
</code></pre>

<p>On updating the .NET Standard project to use the same Xamarin.Forms
NuGet package version the build error would still occur until the solution
was closed and re-opened. Now the remote MSBuild host is shutdown
to ensure the correct Xamarin.Forms MSBuild targets and assemblies
are used after the NuGet package is updated.</p>

<p><strong>Fixed build error after updating Xamarin.Forms NuGet package</strong></p>

<p>On updating the Xamarin.Forms NuGet package in a solution
the build would sometimes fail with errors similar to:</p>

<pre><code>Could not load file or assembly 'Xamarin.Forms.Xaml,
Version=2.0.0.0, Culture=neutral, PublicKeyToken=null' or one of
its dependencies.

Error XF002: Xamarin.Forms tasks do not match targets. Please
ensure that all projects reference the same version of
Xamarin.Forms, and if the error persists, please restart the IDE.
</code></pre>

<p>The problem was that the old MSBuild tasks and targets from the originally used
Xamarin.Forms NuGet package were
still being used. Now when an MSBuild import has changed in a project
the remote MSBuild host is shutdown to ensure the correct MSBuild tasks are
used.</p>

<p><strong>Fixed editor errors when .NET Standard assembly referenced in Xamarin.iOS project</strong></p>

<p>When a Xamarin.iOS project used an assembly that was compiled
for .NET Standard, such as the assembly in the
System.Collections.Immutable NuGet package, the netstandard assembly
was not made available for code completion. This then resulted in the text editor
showing errors even though the project could be compiled succesfully.
The errors displayed were similar to:</p>

<pre><code>  The type 'ValueType' is defined in an assembly that is not
  referenced. You must add a reference to assembly 'netstandard,
  Version=2.0.0.0, Culture=neutral, PublicKeytoken=cc7b1dffcd2ddd51'.
</code></pre>

<p>Now a check is made to determine
if an assembly is referencing netstandard and if so the facade assemblies,
which for Xamarin.iOS will include the netstandard.dll, are made available
for code completion. Previously only a check was made for the project having
an assembly referencing System.Runtime before including the facade assemblies.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NuGet Support in Visual Studio for Mac 7.5]]></title>
    <link href="http://lastexitcode.com/blog/2018/05/19/NuGetSupportInVisualStudioMac7-5/"/>
    <updated>2018-05-19T15:30:00+01:00</updated>
    <id>http://lastexitcode.com/blog/2018/05/19/NuGetSupportInVisualStudioMac7-5</id>
    <content type="html"><![CDATA[<h2>Changes</h2>

<ul>
<li> Support installing NuGet packages with item templates</li>
<li> Fixed generated NuGet package files not available for code completion</li>
<li> Fixed incorrect Android target framework used when the project has Package References</li>
<li> Fixed build errors after creating a new Android project with NuGet packages</li>
<li> Missing package dependencies in Solution window</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.5</a>
can be found in the <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-mac-relnotes#-visual-studio-2017-for-mac-version-75-release-notes">release notes</a>.</p>

<h2>Support installing NuGet packages with item templates</h2>

<p>Initial support for creating new files from item templates that use
the .NET Core templating engine has been added. This is currently used
by the Azure Functions support in Visual Studio for Mac when a new Azure
Function is added to the project. Currently the New File dialog does not
have support for showing these templates but there is an API that can
be used by extensions to create files from these templates.</p>

<p>The item templates can define post actions that indicate that a NuGet
package is needed. These post actions are read and the NuGet
package will be installed into the project by Visual Studio for Mac.</p>

<pre><code>"postActions": [
  {
    "Description": "Adding Reference to Microsoft.Azure.WebJobs.Extensions.DocumentDB Nuget package",
    "ActionId": "B17581D1-C5C9-4489-8F0A-004BE667B814",
    "ContinueOnError": "true",
    "ManualInstructions": [],
    "args": {
      "referenceType": "package",
      "reference": "Microsoft.Azure.WebJobs.Extensions.DocumentDB",
      "version": "1.2.0",
      "projectFileExtensions": ".csproj"
    }
  }
</code></pre>

<h2>Bug Fixes</h2>

<p><strong>Generated NuGet package files not available for code completion</strong></p>

<p>On installing a NuGet package such as Refit, which extends the
CoreCompileDependsOn to generate a C# file, the generated file would
not be available for code completion until the solution was closed
and re-opened again.</p>

<p>Below is a section of the refit.targets file used by the Refit NuGet package.</p>

<pre><code>&lt;PropertyGroup&gt;
  &lt;CoreCompileDependsOn&gt;
    $(CoreCompileDependsOn);
    GenerateRefitStubs;
  &lt;/CoreCompileDependsOn&gt;
&lt;/PropertyGroup&gt;

&lt;Target Name="GenerateRefitStubs" BeforeTargets="CoreCompile"&gt;

  &lt;Error Condition="'$(MSBuildRuntimeType)' == 'Core' and '$(RefitMinCoreVersionRequired)' &gt; '$(RefitNetCoreAppVersion)' "
       Text="Refit requires at least the .NET Core SDK v2.0 to run with 'dotnet build'"
       ContinueOnError="false"
       /&gt;

  &lt;GenerateStubsTask SourceFiles="@(Compile)" BaseDirectory="$(MSBuildProjectDirectory)"   OutputFile="$(IntermediateOutputPath)\RefitStubs.g.cs" /&gt;

  &lt;Message Text="Processed Refit Stubs" /&gt;      

  &lt;ItemGroup Condition="Exists('$(IntermediateOutputPath)\RefitStubs.g.cs')"&gt;
    &lt;Compile Include="$(IntermediateOutputPath)\RefitStubs.g.cs" /&gt;
  &lt;/ItemGroup&gt;    
&lt;/Target&gt;
</code></pre>

<p>The CoreCompileDependsOn property is re-defined so the GenerateRefitsStubs MSBuild
target will be run. This creates a new RefitStubs.g.cs file which is included in the
project by the Compile MSBuild item.</p>

<p>The problem was that the result of running the
targets that are defined by the CoreCompileDependsOn property are cached by Visual
Studio for Mac.
When Refit is installed the cached result was still being returned so the
generated C# file was not available for code completion. To fix this the
project is now re-evaluated before getting the CoreCompileDependsOn property
if an MSBuild import has been added or removed. Note that projects that use
Package References were unaffected. Only projects that use a packages.config
file were affected.</p>

<p><strong>Incorrect Android target framework used when the project has Package References</strong></p>

<p>Configuring an Android project so it uses the latest Android framework
could result in the wrong target framework being used when building if the
project used Package References. This would result in a build error
similar to:</p>

<pre><code>Error: Your project is not referencing the "MonoAndroid,Version=v7.1" framework. 
Add a reference to "MonoAndroid,Version=v7.1" in the "frameworks" section of your 
project.json, and then re-run NuGet restore
</code></pre>

<p>The problem was that the wrong target framework was being used in the
project.assets.json. Running a NuGet restore was
a workaround for the problem.</p>

<p>Now when the target framework version in project options is changed, and
the project uses Package References, a NuGet restore is run after the
project file is saved. This ensures the Package References work with
the new target framework. This also re-generates the project.assets.json file
so the build will use the correct references.</p>

<p>Another problem here was that configuring the Android to use the latest
target framework would not result in the target framework being changed
in the project model stored in memory.
This could also result in the project.assets.json file being out of
sync with the Android project&rsquo;s target framework.</p>

<p><strong>Build errors after creating a new Android project with NuGet packages</strong></p>

<p>Creating a new Android project that installed NuGet packages as it was created
would sometimes result in build errors that could be fixed by closing and
re-opening the solution. An example build error is shown below.</p>

<pre><code>Resources/values/styles.xml : error APT0000: 1: error: Error retrieving parent for item: No resource found that matches the given name 'Theme.AppCompat.Light.DarkActionBar'.
Resources/values/styles.xml : error APT0000: 2: error: Error: No resource found that matches the given   name: attr 'colorAccent'.
Resources/values/styles.xml : error APT0000: 1: error: Error: No resource found that matches the given name: attr 'colorPrimary'.
Resources/values/styles.xml : error APT0000: 1: error: Error: No resource found that matches the given name: attr 'colorPrimaryDark'.
Resources/values/styles.xml : error APT0000: 1: error: Error: No resource found that matches the given name: attr 'windowActionBar'.
Resources/values/styles.xml : error APT0000: 3: error: Error: No resource found that matches the given name: attr 'windowActionModeOverlay'.
Resources/values/styles.xml : error APT0000: 1: error: Error: No resource found that matches the given name: attr 'windowNoTitle'.
Resources/values/styles.xml : error APT0000: 3: error: Error retrieving parent for item: No resource found that matches the given name 'Theme.AppCompat.Light.Dialog'.
Resources/values/styles.xml : error APT0000: 3: error: Error: No resource found that matches the given name: attr 'colorAccent'.
</code></pre>

<p>The build errors varied but in each case the error was caused by a
missing reference to an assembly from one of the Android Support NuGet packages installed
when the project was created. The project file created would have
the correct reference information but Visual Studio for Mac was
building an old version of the project.</p>

<p>If the project was modified in memory when a build is requested this
results in the unsaved project xml being given to the remote MSBuild
host. In some cases this project xml was not being cleared and would
result in an out of date project xml being used when building. This
could occur if the MSBuild host did not have any projects
loaded at the time when an attempt was made to unload the project from
the host. Now the unsaved project xml is removed in all cases when the
project is unloaded from the MSBuild host.</p>

<p><strong>Missing package dependencies in Solution window</strong></p>

<p>After creating a new ASP.NET Core project sometimes the package dependencies
shown in the Solution window under the SDK folder and the NuGet folder
could not be expanded to view the child dependencies.</p>

<p>The problem was that if the call to get the package dependencies
using MSBuild was cancelled this would result an empty list of depenencies
being cached. Since no package dependencies were returned the Solution window
would fallback to showing the package dependencies that were listed in the
project and a default top level SDK package dependency.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NuGet Support in Visual Studio for Mac 7.4]]></title>
    <link href="http://lastexitcode.com/blog/2018/03/10/NuGetSupportInVisualStudioMac7-4/"/>
    <updated>2018-03-10T12:00:00+00:00</updated>
    <id>http://lastexitcode.com/blog/2018/03/10/NuGetSupportInVisualStudioMac7-4</id>
    <content type="html"><![CDATA[<h2>Changes</h2>

<ul>
<li> Support NuGet RestoreProjectStyle MSBuild Property</li>
<li> .NET Core xUnit tests not displayed if NuGet packages not cached</li>
<li> No tests displayed when project uses a NUnit PackageReference</li>
<li> NuGet MSBuild imports not removed when migrating to project.json</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.4</a>
can be found in the <a href="https://docs.microsoft.com/en-us/visualstudio/releasenotes/vs2017-mac-relnotes#15.6">release notes</a>.</p>

<h2>Support RestoreProjectStyle MSBuild property</h2>

<p>If a project sets the RestoreProjectStyle property to be
PackageReference then the project will be restored as though it has
PackageReferences even if it does not have any.</p>

<pre><code>&lt;RestoreProjectStyle&gt;PackageReference&lt;/RestoreProjectStyle&gt;
</code></pre>

<p>This fixes runtime problems when a project references a .NET Standard
project that has PackageReferences. Without the RestoreProjectStyle set
the assemblies from the NuGet packages are not copied to the output
directory and would have to be added to the main project.</p>

<h2>Bug Fixes</h2>

<p><strong>.NET Core xUnit tests not displayed if NuGet packages are not in local NuGet cache</strong></p>

<p>If the NuGet packages that contain the VS Test adapters were not available in
the local machine&rsquo;s NuGet package cache then
the Unit Tests window would not show any tests after the NuGet
packages were restored and the project was compiled.</p>

<p>Visual Studio for Mac would not initially find any test adapter dlls
and would not attempt to discover any tests for the project after the
NuGet packages were downloaded into the NuGet package cache.</p>

<p>Now after the NuGet package restore has completed the check for a
VS Test adapter is now re-run.</p>

<p><strong>No tests displayed when a project uses a NUnit PackageReference</strong></p>

<p>The Unit Tests window would not show any unit tests when a non .NET
Core project contained a NUnit PackageReference. Visual Studio for
Mac was looking for a PackageReference that contained &lsquo;nunit.framework&rsquo;
and was not finding the NUnit NuGet package reference.</p>

<p><strong>NuGet MSBuild imports not removed when migrating to project.json</strong></p>

<p>When a Portable Class Library project was migrated to use a project.json
file the MSBuild imports added by NuGet were not removed. These imports
are added by NuGet into the generated ProjectName.nuget.props and
ProjectName.nuget.targets files on restoring a project.json file.
Leaving the import in the project file would result in the import
being used twice. When a PCL project that used Xamarin.Forms was
migrated to project.json the project would fail to compile with the
error:</p>

<pre><code>Error XF001: Xamarin.Forms targets have been imported multiple times.
Please check your project file and remove the duplicate import(s).
</code></pre>

<p>Now on migrating to project.json the MSBuild imports added by NuGet packages
to the project are removed.</p>

<p><strong>Fix unhandled exception when searching for packages</strong></p>

<p>An unhandled exception was being logged if a package source returned
an error or the package source url was invalid. This was because a
task was not being observed when the package sources were being used.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NuGet Support in Visual Studio for Mac 7.3]]></title>
    <link href="http://lastexitcode.com/blog/2017/12/10/NuGetSupportInVisualStudioMac7-3/"/>
    <updated>2017-12-10T11:00:00+00:00</updated>
    <id>http://lastexitcode.com/blog/2017/12/10/NuGetSupportInVisualStudioMac7-3</id>
    <content type="html"><![CDATA[<h2>Changes</h2>

<ul>
<li> Support installing System.ValueTuple NuGet Package from Quick Fixes</li>
<li> NuGetizer 3000 &ndash; Update NuGet.Build.Packaging to version 0.2</li>
<li> Support NuGet Restore MSBuild Properties

<ul>
<li>RestoreAdditionalProjectFallbackFolders</li>
<li>RestoreAdditionalProjectSources</li>
<li>RestoreFallbackFolders</li>
<li>RestorePackagesPath</li>
<li>RestoreSources</li>
</ul>
</li>
<li> Fixed transitive dependencies not available when using project.json</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.3</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes#release-date-december-4-2017---visual-studio-2017-version-73-730797">release notes</a>.</p>

<h2>Quick Fix &ndash; Install System.ValueTuple NuGet Package</h2>

<p><a href="https://blogs.msdn.microsoft.com/dotnet/2016/08/24/whats-new-in-csharp-7-0/">C# 7.0 introduced tuple types</a>
that may require the System.ValueTuple NuGet package
to be added to the project. Visual Studio for Mac
now offers to install the System.ValueTuple NuGet package if the project requires this NuGet package.</p>

<p>Creating a .NET Framework 4.6 project with the following code:</p>

<p>```</p>

<pre><code>public (string, int) GetValues(string id)
{
    return ("Name", 25);
}
</code></pre>

<p>```</p>

<p>You will see error markers in the text editor. If you hover over
one of these error markers you will see a
<strong>Predefined type &lsquo;System.ValueTuple`2&rsquo; is not defined or imported</strong> message.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-3/ValueTupleTextEditorErrorTooltip.png" title="&lsquo;ValueTuple type not defined text editor error tooltip&rsquo; &lsquo;ValueTuple type not defined text editor error tooltip&rsquo;" ></p>

<p>If you right click the error marker there is now a new
<strong>Install Package &lsquo;System.ValueTuple&rsquo;</strong> Quick Fix action available.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-3/TextEditorInstallSystemValueTuplePackageQuickFix.png" title="&lsquo;Text editor Install System.ValueTuple Package quick fix menu item&rsquo; &lsquo;Text editor Install System.ValueTuple Package quick fix menu item&rsquo;" ></p>

<p>From this menu you can install the latest System.ValueTuple NuGet package
or open the Add Packages dialog to search for a specific version of the System.ValueTuple NuGet
package.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-3/TextEditorInstallLatestSystemValueTupleQuickFix.png" title="&lsquo;Text editor install latest System.ValueTuple package quick fix menu item&rsquo; &lsquo;Text editor install latest System.ValueTuple package quick fix menu item&rsquo;" ></p>

<p>Note that if the project is targeting .NET Framework 4.7 or .NET Standard 2.0 then the
System.ValueTuple NuGet package is not required.</p>

<p>Also note that the official nuget.org package source needs to be available
for this feature to work.</p>

<h2>NuGetizer 3000 &ndash; Updated NuGet.Build.Packaging to version 0.2</h2>

<p>The version of the NuGet.Build.Packaging NuGet package used by default for NuGetizer 3000 support
has been updated from 0.1.276 to 0.2.0. This fixes a
potential build error when building with Mono 5.6.</p>

<p><code>
Using "ReportAssetsLogMessages" task from assembly "/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/../tools/net46/Microsoft.NET.Build.Tasks.dll".
Task "ReportAssetsLogMessages"
/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: The "ReportAssetsLogMessages" task failed unexpectedly. [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: System.TypeLoadException: Could not resolve type with token 0100005b (from typeref, class/assembly NuGet.ProjectModel.IAssetsLogMessage, NuGet.ProjectModel, Version=4.3.0.5, Culture=neutral, PublicKeyToken=31bf3856ad364e35) [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: at Microsoft.NET.Build.Tasks.TaskBase.Execute () [0x00000] in &lt;01420900fd004c128de2d2ee31bad624&gt;:0 [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: at Microsoft.Build.BackEnd.TaskExecutionHost.Microsoft.Build.BackEnd.ITaskExecutionHost.Execute () [0x00023] in &lt;765502eb2f884ce79731edeb4b0517fb&gt;:0 [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
/usr/local/share/dotnet/sdk/2.0.0/Sdks/Microsoft.NET.Sdk/build/Microsoft.PackageDependencyResolution.targets(323,5): error MSB4018: at Microsoft.Build.BackEnd.TaskBuilder+d__26.MoveNext () [0x0022d] in &lt;765502eb2f884ce79731edeb4b0517fb&gt;:0 [RefactoringEssentials/RefactoringEssentials.2017/RefactoringEssentials.csproj]
</code></p>

<p>The ReadLegacyDependencies target from NuGet.Build.Packaging.Tasks is called when PackOnBuild
is set to true.</p>

<p>The NuGet.Build.Packaging.Tasks assembly was loading an embedded NuGet.ProjectModel
assembly that conflicts with the version that is used by Microsoft.NET.Build.Tasks.</p>

<h2>Support RestoreAdditionalProjectFallbackFolders MSBuild Property</h2>

<p>The RestoreAdditionalProjectFallbackFolders MSBuild property is
read and appended to the list of fallback folders stored in the
project.assets.json file. The .NET Core 2.0 SDK will set this
MSBuild property to point to the NuGet package fallback folder
that is installed with the SDK. This will be used
to resolve NuGet packages first before downloading them to the
~/.nuget/packages folder.</p>

<h2>Support RestoreAdditionalProjectSources MSBuild Property</h2>

<p>The RestoreAdditionalProjectSources MSBuild property can be used
to add additional package sources to the existing list of sources
used to resolve packages.</p>

<h2>Support RestoreFallbackFolders MSBuild Property</h2>

<p>The RestoreFallbackFolders MSBuild property can be used by project that uses
PackageReferences to define a set of package fallback folders that
will override any specified in the NuGet.Config file. It can also
be used to clear any pre-defined fallback folders by specifying
&lsquo;clear&rsquo; as its value. Note that this value does not affect any
folders defined by RestoreAdditionalProjectFallbackFolders which
will be appended even if RestoreFallbackFolders is set to &lsquo;clear&rsquo;.</p>

<h2>Support RestorePackagesPath MSBuild Property</h2>

<p>The RestorePackagesPath MSBuild property can be used to override the global packages
folder location when a project uses a PackageReference.</p>

<h2>Support RestoreSources MSBuild property</h2>

<p>The RestoreSources MSBuild property can be used to override
the sources defined by any NuGet.Config file. Any sources defined in the
RestoreAdditionalProjectSources MSBuild property will still be appended to the
list of sources if RestoreSources is defined.</p>

<h2>Bug Fixes</h2>

<p><strong>Transitive dependencies not available when using project.json</strong></p>

<p>With two projects A and B that both use project.json files, project B
referencing project A, the NuGet package dependencies used by project
A were not available to project B transitively. This was because the
project reference information was not being used
when a restore occurred. This caused the assemblies from the transitively
referenced NuGet packages to not be added to the
project.lock.json file for Project B.</p>

<p><strong>Unable to debug a new Azure Functions project without re-opening project</strong></p>

<p>After creating a new Azure Functions project it was possible to build the
project but not to debug it or run it. On closing and re-opening the solution
it would be possible to debug and run the Azure Functions project.</p>

<p>When Visual Studio for Mac created a new Azure Functions project
it initially determined that it could not run or debug the project.
After the Azure Functions project has its PackageReferences restored
it gains an AzureFunctions project capability. This capability is used to
determine if the project can be run. This change in the capability
was not handled by Visual Studio for Mac so it did not allow the
project to be run until the project was closed and re-opened.</p>

<p>Now, after the NuGet package restore is finished, the project is
re-evaluated and a check is made to see if the project can now be run.</p>

<p><strong>Fix generated NuGet files being imported twice</strong></p>

<p>The generated ProjectName.nuget.g.targets and ProjectName.nuget.g.props
that are created for .NET Core projects in the base intermediate
directory were being imported twice when evaluating the project.
Once by Microsoft.Common.props, provided with Mono, and once
by Visual Studio for Mac.</p>

<p>This duplicate import was resulting in a duplicate file being added
to the project held in memory by Visual Studio for Mac when the
Xamarin.Forms 2.4 NuGet package was used in a .NET Standard
project and no .NET Core SDK is installed. This would result in the
content page xaml and associated C# file not being nested in the
solution window.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[NuGet Support in Visual Studio for Mac 7.2]]></title>
    <link href="http://lastexitcode.com/blog/2017/10/28/NuGetSupportInVisualStudioMac7-2/"/>
    <updated>2017-10-28T12:00:00+01:00</updated>
    <id>http://lastexitcode.com/blog/2017/10/28/NuGetSupportInVisualStudioMac7-2</id>
    <content type="html"><![CDATA[<h2>Changes</h2>

<ul>
<li> NuGet 4.3.1 support</li>
<li> NuGet fallback folders support</li>
<li> AssetTargetFallback support</li>
<li> NuGet operations can be cancelled on closing the solution</li>
<li> Fixed transitive types from references not being available</li>
<li> Fixed credential dialog being shown multiple times on opening a solution</li>
</ul>


<p>More information on all the new features and changes in <a href="https://www.visualstudio.com/vs/visual-studio-mac/">Visual Studio for Mac 7.2</a> can be found in the <a href="https://www.visualstudio.com/en-us/news/releasenotes/vs2017-mac-relnotes#release-date-october-9-2017---visual-studio-2017-for-mac-720636">release notes</a>.</p>

<h2>NuGet 4.3.1 support</h2>

<p>NuGet 4.3.1.4445 is now included with Visual Studio for Mac 7.2.</p>

<p>NuGet 4.3.1 includes <a href="https://github.com/NuGet/Home/issues/5806">a fix for imports in the project.json file being ignored</a> which could cause a NuGet package
to incorrectly be considered incompatible when restoring NuGet packages.</p>

<h2>NuGet package fallback folders support</h2>

<p>The .NET Core SDK 2.0 defines a NuGet package fallback folder <code>/usr/local/share/dotnet/sdk/NuGetFallbackFolder</code> that can be used when looking
for NuGet packages whilst restoring. This fallback folder is now supported by
Visual Studio for Mac 7.2 so that on restoring a .NET Core 2.0 project the NuGet
packages from the fallback folder will be found and do not need to be downloaded from nuget.org into the
local machine NuGet package cache <code>~/.nuget/packages</code>. This should speed up NuGet package restore for .NET Core 2.0 and .NET Standard 2.0 projects the first time it occurs.</p>

<p>As well as the NuGet fallback folders Visual Studio for Mac will now add the following items to the generated project.assets.json
if they are available:</p>

<ul>
<li>configFilePaths</li>
<li>sources</li>
<li>warningProperties</li>
</ul>


<h2>AssetTargetFallback support</h2>

<p>The .NET Core 2.0 SDK uses an AssetTargetFallback MSBuild property
defined in an imported SDK MSBuild files. This is used instead
of the PackageTargetFallback property when determining if a NuGet
package is compatible. Currently the AssetTargetFallback property
is set to net461 by the .NET Core 2.0 SDK which allows .NET Core projects to use NuGet
packages that include assemblies that target the full .NET Framework.
The supported fallback frameworks are now added to the generated
project.assets.json file by Visual Studio for Mac when a .NET Core 2.0 project is restored.</p>

<h2>NuGet operations can be cancelled on the closing the solution</h2>

<p>Previously when closing the solution, or closing Visual Studio for Mac, when a NuGet package
operation was still running would result in a dialog being displayed saying that the
solution cannot be closed until the NuGet operation was completed.
NuGet v3 and above now allow the NuGet
operations to be cancelled so now the dialog allows the current
operation to be cancelled. If the
operation is taking a while to cancel a busy spinner image will be displayed in
the dialog.</p>

<p><img src="/images/blog/NuGetSupportInVisualStudioMac7-2/CancelNuGetOperationOnClosingSolutionDialog.png" title="&lsquo;Cancel NuGet operation dialog on closing solution&rsquo; &lsquo;Cancel NuGet operation dialog on closing solution&rsquo;" ></p>

<p>If a restore is being run when the solution
will be closed the restore will be cancelled automatically without showing the dialog.</p>

<h2>NuGet package restore now fails if package and asset target fallbacks are defined by a project</h2>

<p>If both AssetTargetFallback and PackageTargetFallback are defined by a project then the
NuGet restore will fail with an error indicating that they cannot
be used together. This mirrors the behaviour of the .NET Core command
line restore.</p>

<h2>Support imported package references in non .NET Core projects</h2>

<p>If a non .NET Core project had no PackageReference items but imported a file that
did have PackageReference items the NuGet packages were not restored
on opening the solution. This was because only the PackageReference
items defined directly in the project were checked to determine if the
project used NuGet packages. Now the evaluated MSBuild items are checked
so any imported PackageReference items are detected and a restore
will be run on opening the solution.</p>

<p>Note that imported PackageReference items are not displayed in the
Packages folder.</p>

<h2>Package Console is no longer opened when a NuGet operation is cancelled</h2>

<p>When a NuGet operation is cancelled from the main status bar the
Package Console is now not opened when the NuGet operation fails due
to the cancellation. If the NuGet operation is not cancelled then the
Package Console window will still be opened as before if the operation fails.
This is also a workaround for Visual Studio for Mac closing the currently displayed
dialog when the Package Console window opens after the NuGet operation
is cancelled when closing the solution.</p>

<h2>Whitespace is now trimmed when creating a new package source</h2>

<p>When creating a new package source copying and pasting NuGet package source url can sometimes copy extra
whitespace which can then result in NuGet package restore errors such as:</p>

<pre><code>Failed to verify the root directory of local source
' https://api.nuget.org/v3/index.json'.
</code></pre>

<p>The package source name and url will now have whitespace trimmed to avoid
this copy and paste problem. This also
matches Visual Studio on Windows behaviour.</p>

<h2>Mark implicit PackageReferences as auto referenced</h2>

<p>PackageReference items that have IsImplicitlyDefined set to true
in their metadata now have autoRefererenced set to true in the project.assets.json file.</p>

<h2>Bug Fixes</h2>

<p><strong>Fixed transitive assembly references not available until restart</strong></p>

<p>Given a solution that contains three .NET Standard projects: LibC
references LibB which references LibA. If the Newtonsoft.Json NuGet
package was installed into LibA the types from this NuGet package
were not available in LibB or LibC until the solution was closed and
re-opened again. Closing and re-opening the solution refreshes the
reference information used by the type system. Now when a NuGet
package is installed into a .NET Core project the projects that
reference this project have their reference information refreshed. Types from
the installed NuGet packages are then available in projects that
reference this updated project either directly or indirectly.</p>

<p><strong>Fixed transitive project references after editing a project file</strong></p>

<p>Given a solution that contains three .NET Standard projects: LibC references
LibB which references LibA. If a NuGet package is added to LibA by
editing its project file in the text editor the types from this NuGet
package were not available to LibB or LibC without restarting Visual Studio
for Mac or until the packages were restored for the solution. Now when the project file
is saved the projects that directly or indirectly reference the project
will be restored.</p>

<p><strong>Fixed credential dialog shown multiple times on opening a solution</strong></p>

<p>With check for updates enabled, multiple projects in the solution,
and a package source that was missing or had invalid credentials,
on opening the solution the credential dialog would be displayed multiple
times even if the correct username and password was entered or the
dialog was cancelled. The dialog was being displayed for each
project and the credential information was not being re-used.</p>

<p>Now the NuGet source repositories are re-used when checking
for updates and also when restoring the projects when the solution
is first opened. Any valid credentials entered will be re-used
when checking the remaining projects. If the credential dialog is
cancelled then the dialog is no longer displayed again whilst
checking for updates for the other projects.</p>

<p><strong>Fixed credential dialog displayed when credentials are available</strong></p>

<p>With valid credentials stored in the Mac key chain the credential dialog would
still be displayed when it should not have been. The problem was that the
NuGet credential service puts itself in a retry mode if any of the
credential providers are used when trying to authenticate against a
package source. Once in this retry mode the Visual Studio for Mac credential
provider would always show a dialog asking for the credentials instead
of re-using the existing credentials. To avoid this the credential
service is reset before any user actions, such as opening the Add Packages
dialog, running a restore or an update.</p>

<p><strong>Fixed crash when displaying Chinese characters in the Add Packages dialog</strong></p>

<p>With the NuGet v3 package source <a href="https://api.nuget.org/v3/index.json">https://api.nuget.org/v3/index.json</a>
selected, searching for Microsoft.AspNet.WebApi.Client would result in
the Visual Studio for Mac terminating when an attempt was made to display the results
in the Add Packages dialog.
The crash was in the Pango library when it attempted to determine the size of
the package title displayed in the search results. If the package
title contained Chinese characters then Pango would throw an exception:</p>

<pre><code>Illegal byte sequence encounted in the input.
at (wrapper managed-to-native) Pango.Layout:pango_layout_get_pixel_size (intptr,int&amp;,int&amp;)
</code></pre>

<p>Then when Visual Studio for Mac tried to use Pango again to determine the
size of the text this would result in Visual Studio for Mac terminating.</p>

<p>```
Pango-WARNING (recursed) **: shaping failure, expect ugly output.
shape-engine=&lsquo;BasicEngineCoreText&rsquo;, font=&lsquo;.SF NS Text&rsquo;,
text=&lsquo;∫ê'Stacktrace:</p>

<p>  at <unknown> <0xffffffff>
  at (wrapper managed-to-native) Pango.Layout.pango_layout_get_pixel_size (intptr,int&amp;,int&amp;) [0x0000b] in <c7aa2d93df4045df8dc71d5439f99d72>:0
```</p>

<p>If the NuGet v2 package source was used then this crash did not occur
since the package title was not returned in the search results and the package id would be
displayed instead which does not contain Chinese characters.</p>

<p>As a workaround the Add Packages dialog now displays the package id
instead of the package title.</p>

<p><strong>Ignore project references with ReferenceOutputAssembly set to false when restoring</strong></p>

<p>Project references that have ReferenceOutputAssembly are now not
added to the project.assets.json file. This was causing
the NuGet package restore to fail in some cases. For example, if a .NET Standard
project has a project reference to a .NET Core App project, but has the
ReferenceOutputAssembly set to false, then running dotnet restore from the
command line would work, but the restore would fail in Visual Studio for Mac.</p>
]]></content>
  </entry>
  
</feed>
